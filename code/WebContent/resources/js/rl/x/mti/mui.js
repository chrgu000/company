orderjs.define("x:mti.mui",["lib.rpc.engine","lib.rpc.SdtHelper","gui.dialog.Dialog","app.opoa.page","x:mti.muiView"],function(){function main(){initMui()}function initMui(){muiInited||(rl.page.setWindowsMgr(rl.gui.dialog.dialogMgr),rl.page.setTabsMgr(rl.gui.tab.tabFrameMgr),mti.muiView.initialize(muiConfig),rl.gui.tab.tabFrameMgr.tabPanelProxy=mti.muiView.tabPanel,openStartUp(),Function.delay(loadSysMenuData,1e3),muiInited=!0)}function initLoginPanel(){}function loadSysMenuData(){var i=config.urlOfSysMenuData;if(rl.isNonNullStr(i)){var t=mti.muiView.sysMenu,n=new rl.rpc.SdtHelper({url:i,expectRspType:"json",onComplete:function(i,n,e){i==rl.rpc.SDT_LOAD_SUCCESS?t.loadItemNodes(e):t.dw.setInnerHTML(n||g11nSource.loadMenuDataError||"Error loading data")}});n.request()}}function openStartUp(){rl.isNonNullStr(config.urlOfHomepage)&&rl.page.openTab(config.urlOfHomepage,"homepage",{text:g11nSource.homepageTitle||"Homepage",closable:!1}),Array.each(function(action){try{rl.isFunction(action)?action():rl.isNonNullStr(action)&&eval(action)}catch(e){rl.dir(e,"Startup action error!")}},config.startupActions)}function clearSession(i,t){sessionHelper.isRequesting()&&sessionHelper.abort(),sessionHelper.request({url:config.urlOfLogout,onSuccess:i,onFailure:t})}var g11nSource=rl.getG11nSource("rlx.mti.mui")||{};rl.createNamespace("rlx.mti"),rl.createNamespace("rlx.mti.mui");var muiInited,loginPanelInited,mti=rlx.mti,mui=mti.mui,config=rlx.mti.config,sessionHelper=new rl.rpc.SdtHelper({url:config.urlOfLogStatus,expectRspType:"json"}),muiConfig={u:{action:function(){},items:[{text:config.userName||"",tip:rl.getG11nSource("openMyAccount")||"open my account",icon:config.userIcon||rl.XROOT_PATH+"mti/image/common/user.gif",action:function(){rl.page.open(config.urlOfAccountInfo,"accountInfo",{width:550,height:400})}},{ctype:"MenuSplit"},{text:rl.getG11nSource("exit")||"exit",action:function(){Function.defer(function(){confirm(rl.getG11nSource("confirmExit")||"Exit system?")&&mui.logout()})}}]},m:{action:function(actionData){if(rl.isNonNullStr(actionData)&&(actionData=actionData.trim(),actionData=actionData.startsWith("{")?eval("("+actionData+")"):{url:actionData}),!rl.isObject(actionData)||!rl.isString(actionData.url))return void rl.debug(this+" Invalid data of sysMenu, actionData = "+actionData,"err");var webRoot=config.webRoot,url=actionData.url;url=url.contains("://")||url.startsWith("/")?url:webRoot+(webRoot.endsWith("/")?"":"/")+url,rl.page.openTab(url,actionData.tabName)},items:[]},l:{src:config.logo,iniStyle:{}},q:{items:[]},t:{frameItemListener:function(){var i,t=this.getContentWindow();if(t)try{i=!!t.rl}catch(n){}if(!i){var e=mti.muiView.tabPanel.findItemByPageElement(this.dw.dom);e&&e.head.setIcon(rl.page.defaultPageIcon)}}}};rl.ext(mui,{showRelogin:rl.EMPTY_FUNCTION,showMainUI:function(){muiInited||initMui(),rl.isFunction(mui.hideLoginPanel)&&mui.hideLoginPanel()},logout:function(){window.location.replace(config.urlOfLogout)},exit:function(){function i(){if(rl.IE)try{window.opener=null,window.open("","_self")}catch(i){}window.close()}Function.defer(function(){confirm(rl.getG11nSource("confirmExit")||"Exit system?")&&clearSession(i,i)})},checkLogined:function(i,t){sessionHelper.isRequesting()&&sessionHelper.abort(),sessionHelper.request({url:config.urlOfLogStatus,onSuccess:i,onFailure:t})}}),rl.onReady(main)});