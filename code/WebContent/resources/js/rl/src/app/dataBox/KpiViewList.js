orderjs.define("app.dataBox.KpiViewList",["gui.engine","app.dataBox.engine"],function(){rl.dataBox.KpiViewList=rl.createClass({parent:rl.gui.ContainerBase,construct:function(e){rl.isPrototyping(arguments[0])||(rl.dataBox.KpiViewList.parent.call(this,e),this.initialize())},members:{compOptions:null,compLayout:"flow",compType:null,comps:null,action:null,actionEventName:"click",autoHideScrollbar:!0,width:"auto",height:"auto",autoRenderOnReady:!1,_selectable:!1,_selectedComp:null,_selectedIndex:-1,_iniSelectedIndex:0,_htmlTpl:new rl.HtmlTpl('<div id="{id}"></div>'),initialize:function(){rl.isNonNullStr(this.id)||(this.id=this.autoId()),this.dw=new rl.dom.DomWrap,this.comps=[],this.autoRenderOnReady&&rl.onReady(this.render,this)},initComps:function(){var e=this.compDataList;return rl.isArray(e)?void(this.comps=Array.map(this.createComp,e,this)):void rl.debug(this+" -> initComps(): this compDataList is not loaded!","err")},createComp:function(){var e=this.compType;if(rl.isNonNullStr(e)&&(e=rl.dataBox[e]),rl.isFunction(e)){var t={owner:this};return new e(rl.fill(t,this.compOptions))}return rl.debug(this+"->createComp(): Invalid compType= "+e,"err"),null},getItems:function(){return this.comps},render:function(e){if(this._rendered)return this;e=this.getRenderTarget(e);var t=this._htmlTpl.renderTo(e,{id:this.id},this.renderPosition);return this.dw.setTarget(t),this._renderComps(t),this._initEvents(),this._selectable&&this._iniSelectedIndex>-1&&this.selectComp(this._iniSelectedIndex),this._rendered=!0,this.fireEvent("render"),this},_renderComps:function(e){var t,i=this.comps,n=this.compDataList;Array.each(function(i,s){if(!i._rendered)if(t=n[s])i.renderTarget=e,i.loadData(t);else{var r=this+"-> _renderComps(): Cant found "+i+"(id ="+i.id+")'s correspond data";rl.debug(r,"err")}},i,this)},_initEvents:function(){this._selectable&&this.dw.on("mousedown",this.hndMousedown,this)},getCompByEvent:function(e){var t=rl.ew.init(e).getTarget();return this._getCompByEle(t)},_getCompByEle:function(e){return rl.isElement(e)&&(e=rl.dom.findParentBy(e,this._isItemEle,this),rl.isElement(e))?Array.find(function(t){return t.dw.dom===e},this.comps):void 0},_isItemEle:function(e){return rl.isElement(e)&&e.parentNode==this.dw.dom},hndMousedown:function(e){var t=this.getCompByEvent(e);t&&rl.isFunction(t.setSelected)&&this.selectComp(t)},selectComp:function(e){var t=this.comps,i=rl.isNumber(e)?t[e]:e,n=this._selectedComp;rl.debug(this+" index = "+e+" comp = "+i),i&&i!=n&&rl.isFunction(i.setSelected)&&(n&&rl.isFunction(n.setSelected)&&n.setSelected(!1),i.setSelected(!0),this._selectedIndex=rl.isNumber(e)?e:t.indexOf(i),this._selectedComp=i,this.fireEvent("change"))},unselectComp:function(e){var t=this.comps,i=rl.isNumber(e)?t[e]:e;i&&rl.isFunction(i.setSelected)&&(i.setSelected(!1),this._selectedIndex=-1,delete this._selectedComp,this.fireEvent("change"))},loadData:function(e){if(!rl.isObject(e)||!rl.isObject(e.data)){var t=this+"-> loadData(): Invalid data = "+e;throw{description:t}}this.compDataList=e.data,this._rendered||(this.comps.length>1||this.initComps(),this.render())},toString:function(){return"[object rl.dataBox.KpiViewList]"}}})});