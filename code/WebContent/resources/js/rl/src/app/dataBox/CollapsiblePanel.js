orderjs.define("app.dataBox.CollapsiblePanel",["lib.rpc.engine","app.dataBox.engine","css>rl:databox"],function(){rl.dataBox.CollapsiblePanel=rl.createClass({parent:rl.dataBox.CompPanel,construct:function(){rl.isPrototyping(arguments[0])||rl.dataBox.CollapsiblePanel.parent.apply(this,arguments)},members:{data:null,dataUrl:"",dataExpectRspType:"json",iniCollapsed:!0,collapsed:!0,expandedCss:"rl_databox_collapsible_panel_expanded",collapsedCss:"rl_databox_collapsible_panel_collapsed",headerMouseoverCss:"header_mouseover",dataViewType:"",dataViewOptions:null,caption:"",captionCss:"",autoRenderOnReady:!0,autoLoadOnRender:!1,autoLoadOnFirstExpand:!0,_htmlTpl:new rl.HtmlTpl('<div class="rl_databox_comp_panel rl_databox_collapsible_panel {css}" id="{id}" style="{width}" ><table class="main_wrapper" border="0" cellspacing="0" cellpadding="0"><tr id="{headerId}" class="header"><td id="{captionCtnId}" class="{captionCss}"><span>{caption}</span></td><td><img id="{indicatorIconId}" class="indicator_icon" src="'+rl.gui.URL_BLANK_IMG+'" /></td></tr><tr id="{bodyId}" style="display:{bodyDisplay}"><td colspan="2" id="{contentWrapperId}"><div class="p_tip_pos_wrapper"><div class="p_tip_wrapper" id="{tipWrapperId}"><div class="p_tip_shim"></div><div class="p_tip" id="{tipCtnId}">{tip}</div></div></div><div id="{compCtnId}" class="comp_ctn"></div></td></tr></table></div>'),initialize:function(){rl.isNonNullStr(this.id)||(this.id=this.autoId()),this.headerId=this.id+"_header",this.contentWrapperId=this.id+"_contentWrapper",this.captionCtnId=this.id+"_captionCtn",this.indicatorIconId=this.id+"_indicatorIcon",this.tipCtnId=this.id+"_tipCtn",this.tipWrapperId=this.id+"_tipWrapper",this.compCtnId=this.id+"_compCtn",this.bodyId=this.id+"_body",this.dw=new rl.dom.DomWrap,this.initDataView(),this.initHttpRequest(),this.autoRenderOnReady&&rl.onReady(this.render,this)},render:function(t){if(this._rendered)return this;t=this.getRenderTarget(t);var i=this.collapsed,s=(i?this.collapsedCss:this.expandedCss)+" "+(this.css||""),e=this._htmlTpl.renderTo(t,{id:this.id,headerId:this.headerId,contentWrapperId:this.contentWrapperId,captionCtnId:this.captionCtnId,indicatorIconId:this.indicatorIconId,tipWrapperId:this.tipWrapperId,tipCtnId:this.tipCtnId,compCtnId:this.compCtnId,bodyId:this.bodyId,css:s,caption:this.caption,captionCss:this.captionCss,bodyDisplay:i?"none":"",width:this.width?"width : "+rl.dom.addUnit(this.width)+";":""},this.renderPosition);return this.dw.setTarget(e),this.initEvents(),this.initHeader(),this.setCollapse(this.iniCollapsed),this._rendered=!0,this.autoLoadOnRender&&this.load(),this.fireEvent("render"),this},initEvents:function(){this.on("collapse",this.hndCollapse,this),this.on("expand",this.hndExpand,this)},initHeader:function(){rl.$(this.headerId).on("click",this.hndHeaderClick,this,!1).on("mouseover",this.hndHeaderMouseover,this,!1).on("mouseout",this.hndHeaderMouseout,this,!1)},collapse:function(){return this.collapsed?this:(this.collapsed=!0,rl.$(this.bodyId).setStyle({display:"none"}),this.fireEvent("collapse"),this)},expand:function(){return this.collapsed?(this.collapsed=!1,rl.$(this.bodyId).setStyle({display:""}),this.fireEvent("expand"),this):this},toggleCollapse:function(){return this.setCollapse(!this.collapsed)},setCollapse:function(t){return t?this.collapse():this.expand(),this},load:function(t){return this.showTip(this.loadingMsg),this._lastRequestData=this.data,delete this.data,this.httpRequest.request(rl.ext({},t)),this},hndCollapse:function(){this.dw.removeClass(this.expandedCss).addClass(this.collapsedCss)},hndExpand:function(){this.dw.removeClass(this.collapsedCss).addClass(this.expandedCss),this.autoLoadOnFirstExpand&&!this._everExpanded&&(this.load(),this._everExpanded=!0)},hndHeaderClick:function(){this.toggleCollapse()},hndHeaderMouseover:function(){rl.$(this.headerId).addClass(this.headerMouseoverCss)},hndHeaderMouseout:function(){rl.$(this.headerId).removeClass(this.headerMouseoverCss)},toString:function(){return"[object rl.dataBox.CollapsiblePanel]"}}})});