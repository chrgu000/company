/**
 * @fileOverview Decorators engine.
 * @change
 	#1 by prcjack Creates file.
 */
orderjs.define("app.deco.engine",["open.jquery.jquery","lib.rpc.JqAjax"],function(){var t=this.track,r=orderjs("open.jquery.jquery"),e=orderjs("lib.rpc.JqAjax");r.fn.getDecorator=function(t){var e=null,i=h.instStoreKey;return rl.isNonNullStr(t)?e=this.filter(t).data(i):rl.isNumber(t)?e=this.eq(t).data(i):r.isPlainObject(t)?this.each(function(n){var o=r(this).data(i);if(o){var s=!0;for(var n in t)if(t[n]!=o[n]){s=!1;break}if(s)return e=o,!1}}):rl.isFunction(t)?this.each(function(){var n=r(this).data(i);return n&&t(n)?(e=n,!1):void 0}):e=this.data(i),e};var i=rl.createClass({parent:rl.util.EventProvider,construct:function(){rl.isPrototyping(arguments[0])||(i.parent.apply(this,arguments),this.initialize.apply(this,arguments))},members:{target:"",initialize:function(t){return this.setOptions(t).deco(),this},deco:function(){return this.decorated?this:(this.jq=r(this.target),this.jq.length||rl.raiseError("Invalid target = "+this.target,t(this,"deco")),this.initTarget().prop(function(){this.jq.data(h.instStoreKey,this)}).prop("decorated",!0).fireEvent("deco"),this)},dispose:function(){return this.disposed||this.onDispose().prop(function(){this.jq.remove()}).clearAllEvents().prop("disposed",!0),this},embedDecorator:function(t,r){return this[t]=r,this},fireEvent:function(){return this._result=i.parent.prototype.fireEvent.apply(this,arguments),this},initTarget:function(){return this},onDispose:function(){return this},prop:function(t,r){if(rl.isNonNullStr(t)){var e=arguments.length;if(1==e)return this[t];this[t]=r}else rl.isObject(t)?rl.ext(this,t):rl.isFunction(t)&&t.apply(this,rl.slice(arguments,1));return this},result:function(){return this._result},setOptions:function(t){return rl.isNonNullStr(t)&&(t={target:t}),this.prop(t)},toString:function(){return"[object DecoratorBase]"}}}),n=rl.createClass({parent:i,construct:function(){rl.isPrototyping(arguments[0])||n.parent.apply(this,arguments)},members:{field:"",fieldJq:null,initField:function(){if(this.field!==!1){var t=rl.isNonNullStr(this.field)?r(this.field):this.jq.find("input[name]").first();t.length&&(this.fieldJq=t)}return this},onDispose:function(){return this.fieldJq&&this.fieldJq.remove(),this},updateField:function(t){return this.fieldJq&&this.fieldJq.val(t),this},toString:function(){return"[object FormContorl]"}}}),o=rl.createClass({parent:i,construct:function(){rl.isPrototyping(arguments[0])||o.parent.apply(this,arguments)},members:{showTip:function(){return this},update:function(){return this},toString:function(){return"[object DataBox]"}}}),s=rl.createClass({parent:i,construct:function(){rl.isPrototyping(arguments[0])||s.parent.apply(this,arguments)},members:{holder:void 0,hide:function(){return this.jq.hide(),this},initTarget:function(){return this.holder&&(this.holderJq=this.jq.find(this.holder)),this},show:function(t){return this.jq.show(),(this.holderJq||this.jq).html(t),this},toString:function(){return"[object Notifier]"}}}),a=rl.createClass({parent:o,construct:function(){rl.isPrototyping(arguments[0])||a.parent.apply(this,arguments)},members:{comp:null,hideCompOnTip:!1,notifier:null,hideTip:function(){return this.notifier.hide(),this},initComp:function(){return rl.isNonNullStr(this.comp)?this.comp=r(this.comp).getDecorator():this.comp instanceof r&&(this.comp=this.comp.getDecorator()),this},initTarget:function(){return this.initComp(),this},showTip:function(t){return this.notifier.show(t),this.hideCompOnTip&&this.comp.hide(),this},update:function(t){return this.hideCompOnTip&&this.comp.show(),this.comp.update(t),this.notifier.hide(),this},toString:function(){return"[object CompTipWrap]"}}}),c=rl.createClass({parent:e,construct:function(t){return this instanceof c?void(rl.isPrototyping(arguments[0])||c.parent.apply(this,arguments)):new c(t)},members:{msgError:"抱歉，加载失败：{msg}",msgLoading:"数据加载中...",msgNoData:"当前无数据",view:null,initialize:function(){c.parent.prototype.initialize.apply(this,arguments),this.initView()},beforeSend:function(){var t=this.view,r=this.msgLoading;rl.isFunction(t.updateLoading)?t.updateLoading(r):this.showTip(r)},error:function(t,r,e,i){t=rl.format(this.msgError,{msg:t});var n=this.view;rl.isFunction(n.updateError)?n.updateError(t,i):this.showTip(t,i)},initView:function(){return rl.isNonNullStr(this.view)?this.view=r(this.view).getDecorator():this.view instanceof r&&(this.view=this.view.getDecorator()),this.view&&rl.isFunction(this.view.update)||rl.raiseError("Invalid this.view or its update method is undefined!",t(this,"initView",this.view)),this},load:function(){return this.request.apply(this,arguments)},showTip:function(t){rl.isFunction(this.view.showTip)&&this.view.showTip(t)},success:function(t){var r=this.view;try{rl.isDefined(t)?r.update(t):rl.isFunction(r.updateNoData)?r.updateNoData(this.msgNoData):this.showTip(this.msgNoData)}catch(i){return rl.dir(i,this+" success(): view update error: <br>"+i,"err"),e.defaultMsgs.dataerror}},toString:function(){return"[object ViewLoader]"}}}),u=!1,l=new rl.util.Event,h={DecoratorBase:i,decoRootId:"rlDecoRoot",instStoreKey:"__rl_deco_inst",jqDecoratorTypes:{},jqDecoAdapters:{"default":function(t,e,i,n){return r.isPlainObject(i)&&(n=i,i=null),r(e,i).each(function(){var e=r(this).data(h.instStoreKey);return e||new t(rl.fill({target:this},n))})},renderable:function(t,e,i,n){return r.isPlainObject(i)&&(n=i,i=null),r(e,i).each(function(){function e(){r(i.renderTarget).data(h.instStoreKey,i)}var i=r(this).data(h.instStoreKey);return i||(i=new t(rl.fill({renderTarget:this},n)),r(i.renderTarget).length?e():rl.onReady(e)),i})}},JqAjax:e,objNameRE:/\[object\s+(.*)?\s*?\]/i,ViewLoader:c,_decoListeners:[],decoArea:function(e,i){var n=[],o=r(i||"[rl-deco]",e);o.each(function(){var e=rl.trim(r(this).attr("rl-deco"));if(rl.isNonNullStr(e)){var i=h.jqDecoratorTypes[e.toLowerCase()];if(i){var o=rl.trim(r(this).attr("rl-deco-options"));try{rl.isNonNullStr(o)&&(o=new Function("return "+o)())}catch(s){rl.raiseError("Parse deco options error: "+s,t(h,"decoArea",{target:this}))}i(this,null,o),r(this).attr("rl-deco-embedded")&&n.push(this)}else rl.raiseError("Cant deco with invalid decorator type = "+e,t(h,"decoArea",{target:this}))}}),h.decoEmbeddeds(n)},decoEmbeddeds:function(e){rl.isArray(e)||(e=[e]),rl.each(e,function(e){if(rl.isElement(e)&&!e._rl_embedded){var i,n,o=r(e).attr("rl-deco-embedded");if(o){var s=o.split("@"),i=rl.trim(s[0]),a=rl.trim(s[1]),n=(a?r(a):r(e).parent("[rl-deco]")).getDecorator();if(n){var c=r(e).getDecorator();rl.isFunction(n.embedDecorator)?n.embedDecorator(i,c):n[i]=c,e._rl_embedded=!0}else rl.raiseError("Cant find owner for embedded = "+o,t(h,"decoEmbeddeds",{target:e}))}}})},decoRoot:function(){if(!u){var e=r("#"+h.decoRootId).first();e.length||(e=r(document.body)),e.length?(h.decoArea(e,e.attr("deco-selector")),h.fireReady()):rl.raiseError("The decoRoot element is unready!",t(this,"decoRoot"))}},fireReady:function(){u||(u=!0,l.fire(),l.clear())},makeJqDeco:function(r,e,i){if(!rl.isNonNullStr(e)){var n=String(r.prototype).match(h.objNameRE);n&&rl.isNonNullStr(n[1])?e=n[1]:rl.raiseError("Cant find alias for decorator!",t(h,"makeJqDeco",{decorator:r}))}rl.isFunction(i)||(i=h.jqDecoAdapters[i||"default"]),rl.isFunction(i)||rl.raiseError("Cant find decorator adapter with speicified param = "+i,t(h,"makeJqDeco",{decorator:r}));var o=rl.ext(rl.curry(i,r),{decorator:r});return h.jqDecoratorTypes[e.toLowerCase()]=o,o},onReady:function(t,r){rl.isFunction(t)&&(r=r||null,u?t.call(r):l.addHandler(t,r))},toString:function(){return"[object decoEngine]"}};return h.FormContorl=h.makeJqDeco(n),h.CompTipWrap=h.makeJqDeco(a),h.Notifier=h.makeJqDeco(s),h.DataBox=h.makeJqDeco(o),h});