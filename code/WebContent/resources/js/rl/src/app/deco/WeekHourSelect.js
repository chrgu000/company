/**
 * @fileOverview WeekHourSelect class.
 * Note: this is a deco module, a css module is required (defaults to "css>open.jQuery-idTabs.jquery_idtabs").
 * @change
 	#1 by prcjack @2014/11/19 Creates file.
 */
orderjs.define("app.deco.WeekHourSelect",["open.jquery.jquery","app.deco.engine","css>rl:inputs"],function(){var e=this.track,t=orderjs("open.jquery.jquery"),s=orderjs("app.deco.engine"),i=rl.createClass({parent:s.FormContorl.decorator,construct:function(){rl.isPrototyping(arguments[0])||i.parent.apply(this,arguments)},members:{dataSource:null,disabled:!1,evenHourCss:"",hourCellCss:"hour_cell",iniSelection:"",oddHourCss:"odd_hour",placeHolder:"",selectedCss:"selected",selectMode:"select",stripeHours:!0,value:void 0,_htmlTpl:['<table class="grid" border="0" cellspacing ="0" cellpadding="0"  >',"{headerHtml}","{rowsHtml}","</table>"].join(""),getHourCells:function(){return this.jq.find("."+this.hourCellCss)},getHeaderHtml:function(){var e,t,s=['<tr class="header">','<td class="cell header_cell">',"&nbsp;</td>"];for(e=0;24>e;e++)t=e+"",10>e&&(t="0"+t),s.push('<td class="cell header_cell" colspan="2">',t,"</td>");return s.push("</tr>"),s.join("")},getRenderHtml:function(){return rl.format(this._htmlTpl,{headerHtml:this.getHeaderHtml(),rowsHtml:this.getRowsHtml()})},getRowsHtml:function(){for(var e,t,s,i,l,r=[],a="",n=(this.cellCss,this.hourCellCss),o=this.oddHourCss,d=this.evenHourCss,h=this.stripeHours,u=rl.getG11nSource("dayNames"),c=0;7>c;c++){for(r.push("<tr>"),r.push('<td class="cell dayname_cell">',u[c],"</td>"),e=0;48>e;e++)h&&(s=e%4==2||e%4==3,a=s?o:d),i=48*c+e,t=parseInt(e/2),l=u[c]+" "+(t>9?t:"0"+t)+":"+(e%2==0?"00":"30"),r.push('<td class="cell ',n," ",a,'"',' data-idx="',i,'"',' title="',l,'"',">&nbsp</td>");r.push("</tr>")}return r.join("")},getSelection:function(){for(var e="",t=(this.selectedCss,i.hexValues),s=this.getHourCells(),l=0;7>l;l++)for(var r=0;48>r;r+=4){var a=48*l+r,n=this.isCellSelected(s[a+0]),o=this.isCellSelected(s[a+1]),d=this.isCellSelected(s[a+2]),h=this.isCellSelected(s[a+3]),u=n<<3|o<<2|d<<1|h<<0;e+=t[u]}return e},hndMousedown:function(e){if(!this.disabled){var s=t(e.target).attr("data-idx"),i=s%48,l=(s-i)/48;i>-1&&l>-1&&this.jq.data("startpos",{row:l,col:i})}},hndMouseup:function(e){if(!this.disabled){var s=this.jq.data("startpos");if(s){var i=e.target,l=t(i).attr("data-idx"),r=l%48,a=(l-r)/48,n=s.col,o=s.row;r==n&&a==o?this.selectCell(i,!this.isCellSelected(i)):r>-1&&a>-1&&(this.jq.data("endpos",{row:a,col:r}),this.updateSelectionByEvent(e)),this.jq.removeData("startpos endpos")}}},hndMousemove:function(e){if(!this.disabled){var s=this.jq.data("startpos");if(s){var i=e.target,l=t(i).attr("data-idx"),r=l%48,a=(l-r)/48,n=s.col,o=s.row;(r!=n||a!=o)&&r>-1&&a>-1&&(this.jq.data("endpos",{row:a,col:r}),this.updateSelectionByEvent(e))}}},hndMouseout:function(e){if(!this.disabled){var s=t(e.relatedTarget).closest(this.jq).length;s||this.jq.removeData("startpos endpos")}},initEvents:function(){return this.jq.on("mousedown",rl.bind(this.hndMousedown,this)).on("mouseup",rl.bind(this.hndMouseup,this)).on("mousemove",rl.bind(this.hndMousemove,this)).on("mouseout",rl.bind(this.hndMouseout,this)).on("selectstart",function(){return!1}),this},initField:function(){if(i.parent.prototype.initField.apply(this,arguments),this.fieldJq){var e=this.fieldJq.prop("disabled");e&&this.setDisabled(!0)}return this},initSelection:function(){var e=this.value||"";return this.fieldJq&&(e=this.fieldJq.val()||""),rl.isNonNullStr(e)&&this.updateSelection(e),e.length<84&&(e=(e+i.padValues).substr(0,84)),this.value=e,this},initTarget:function(){return this.initField().render().initEvents().initSelection(),this},isCellSelected:function(e){return t(e).hasClass(this.selectedCss)},isNonSelect:function(){return this.value===i.padValues},render:function(){return this.jq.addClass("rl_weekhourselect").append(this.getRenderHtml()),this.placeHolder&&t(this.placeHolder).hide(),this},selectCell:function(s,l){var r=parseInt(rl.isElement(s)?t(s).attr("data-idx"):s),a=this.getHourCells();if(s=a[r],s||rl.raiseError("Invalid cell.",e(this,"selectCell",s)),this.isCellSelected(s)==l)return this;var n=r%4,o=(r-n)/4,d=i.hexValues;this.updateCellSelection(s,l);var h=this.isCellSelected(a[r-n]),u=this.isCellSelected(a[r-n+1]),c=this.isCellSelected(a[r-n+2]),p=this.isCellSelected(a[r-n+3]),f=h<<3|u<<2|c<<1|p<<0,v=d[f],C=this.value,m=C.split("");return m[o]=v,this.value=m.join(""),rl.debug(this+" idx = "+r+" idxMod = "+n+" maskIdx = "+o+" mask = "+v+" oval = "+C+" this.value = "+this.value),this.updateField(this.value).fireEvent("change",this.value,C),this},setDisabled:function(e){return this.disabled!==e&&(this.disabled=e,this.jq[e?"addClass":"removeClass"]("disabled"),this.fieldJq&&this.fieldJq.prop("disabled",e)),this},updateCellSelection:function(e,s){return t(e)[s?"addClass":"removeClass"](this.selectedCss),this},updateSelection:function(e){if(!rl.isNonNullStr(e))return this;var t,s,i,l,r,a,n,o,d=this.getHourCells(),h=this.value||"";for(t=0,s=e.length;s>t&&84>t;t++)if(i=4*t,l=parseInt(e.charAt(t),16),r=parseInt(h.charAt(t),16),r!==l)for(a=0;4>a;a++)n=i+a,o=d[n],this.updateCellSelection(o,l&1<<3-a);return this.updateField(e).prop("value",e),this},updateSelectionByEvent:function(e){var t=this.jq.data("startpos"),s=this.jq.data("endpos");if(!t||!s)return this;var i=this.getHourCells(),l="unselect"==this.selectMode||e.ctrlKey,r=Math.min(t.col,s.col),a=Math.max(t.col,s.col),n=Math.min(t.row,s.row),o=Math.max(t.row,s.row);rl.debug(this+" minCol = "+r+" maxCol = "+a+" minRow = "+n+" maxRow = "+o);for(var d=n;o>=d;d++)for(var h=r;a>=h;h++){var u=48*d+h;this.selectCell(i[u],!l)}return this},updateValue:function(){return this.val(this.getSelection()),this},val:function(e){if(0==arguments.length)return this.value;var t=this.value;return t==e?this:(this.updateSelection(e).fireEvent("change",e,t),this)},toString:function(){return"[object WeekHourSelect]"}}});return i.hexValues=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],i.padValues=new Array(85).join("0"),s.makeJqDeco(i)});