/**
 * Orderjs - Order js in order.
 * http://soofound.com
 * 
 * Copyright 2013, prcjack
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 *
 * Orderjs is a file(js, css) and module loader. 
 * It loads modules asynchronously, but executes them in sequence ordered by user.
 */
(function(){function e(){return z.require.apply(z,arguments)}function t(e,t){for(var i in t)e[i]=t[i];return e}function i(e){return!(!e||e.constructor!==Array)}function s(e){return"function"==typeof e}function n(e){return e&&"object"==typeof e}function r(e){return"string"==typeof e||e&&e.constructor===String}function o(e){return r(e)&&""!==String(e)}function a(e){return null==e?"":e.replace(S,"")}function u(e,t,i){if(n(e))for(var s=0,r=e.length;r>s;s++)if(t.call(i,e[s],s,e)===!1)return}function c(e,t,i){var s=[];return u(e,function(n,r){s.push(t.call(i,n,r,e))}),s}function h(e,t,i){var s=[];return u(e,function(n,r){t.call(i,n,r,e)&&s.push(n)}),s}function d(e,t){return function(){return e.apply(t,arguments)}}function f(e){return c(e.split("../"),function(e){return e.replace(L,"")}).join("../")}function p(e,t){if(e=f(e),0===e.indexOf("/"))return N.protocol+"//"+N.host+e;if(e.indexOf(":")>-1)return e;var i=(t||y||N.href).split("/");for(i.pop();E.test(e);)i.pop(),e=e.replace(E,"");return i.join("/")+"/"+e}function l(t,i){s(t)&&(n(i)||s(i)||(i=null),e.READY?t.call(i):x.push([t,i]))}function m(){e.READY||(e.READY=!0,x&&(u(x,function(e){e[0].call(e[1])}),x=[]))}function g(){document.detechEvent?(document.detachEvent("onreadystatechange",v),window.detachEvent("onload",v)):document.removeEventListener&&(document.removeEventListener("DOMContentLoaded",v,!1),window.removeEventListener("load",v,!1))}function v(){(document.addEventListener||/loaded|complete/.test(document.readyState))&&(g(),m())}var y,_=this,D=(_.orderjs,new Function),E=/\.\.\//,L=/\.\//g,S=/(^\s+)|\s+$/g,b=document,C=b.getElementsByTagName("HEAD")[0],N=b.location,x=[];if("complete"===document.readyState)setTimeout(m,10);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",v,!1),window.addEventListener("load",v,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",v),window.attachEvent("onload",v);var j=!1;try{j=null==window.frameElement&&document.documentElement}catch(R){}j&&j.doScroll&&!function(){if(!e.READY){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,50)}g(),setTimeout(m,10)}}()}var k=b.getElementsByTagName("script"),w=b.getElementById("orderjsNode")||k[k.length-1],B=p(w.getAttribute("src")),M=w.getAttribute("data-main");y=B.substr(0,B.lastIndexOf("/")+1),C||(C=w.parentNode);var O=b.attachEvent,A=O&&!(O.toString&&O.toString().indexOf("[native code")<0)&&!window.opera,q=e.fileLoader={_startedUris:{},_cacheBuster:(new Date).getTime(),cacheBusterName:"_cacheBuster",load:function(t,i,s){if(!r(t))return null;if(!this._startedUris[t]){this._startedUris[t]=!0;var n,a,u=e.config("disableCache");return u&&(a=o(u)?encodeURIComponent(u):this._cacheBuster,t+=(t.indexOf("?")>-1?"":"?")+"&"+this.cacheBusterName+"="+a),i?(n=b.createElement("link"),n.type="text/css",n.rel="stylesheet",n.href=t):(n=b.createElement("script"),n.type="text/javascript",n.src=t),this.observe(n,i,s),C.appendChild(n),n}},observe:function(e,t,i){function n(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(A?e.detachEvent("onreadystatechange",n):(e.removeEventListener("load",n,!1),e.removeEventListener("error",n,!1)),s(i)&&i())}A?e.attachEvent("onreadystatechange",n):t?this.pollCss(e,n):(e.addEventListener("load",n,!1),e.addEventListener("error",n,!1))},pollCss:function(e,t){var i=this,n=!!e.sheet;setTimeout(function(){n?s(t)&&t():i.pollCss(e,t)},50)},toString:function(){return"[object orderjs.fileLoader]"}},T=e.execStack={_modules:[],executedList:[],push:function(e){var t=this._modules;if(e&&!this.contains(e)){var i=e.readyState;3>i&&(t.push(e),this.check())}return e},pop:function(){return this._modules.pop()},peek:function(){var e=this._modules;return e[e.length-1]},isExecuting:function(e){return this.peek()==e},isEmpty:function(){return!this._modules.length},contains:function(e){var t=this._modules;if(t.indexOf)return t.indexOf(e)>-1;for(var i=0,s=t.length;s>i;i++)if(t[i]===e)return!0;return!1},check:function(){var e,t=this.peek();t&&(e=t.readyState,e>=2&&t.isDepsComplete()?this.doExecution(t):(this.checkDeps(t),0==e&&t.load()))},hndReady:function(e){var t=this.peek();t&&(t==e||0==t.readyState)&&this.check()},doExecution:function(e){this.executedList.push(e);try{e.exec()}catch(t){this.hndExecErr(t,e)}finally{this.pop(),this.isEmpty()?z.checkOrderListExec(e):this.check()}},checkDeps:function(e){u(e.getDeps(),this.checkDep,this)},checkDep:function(e){var t=z.getByName(e);if(t){var i=t.readyState;if(3>i)return this.push(t),0==i?t.load():this.check(),!1}},hndExecErr:function(e){throw e},toString:function(){return"[object orderjs.execStack]"}},I=e.Module=function(){this.initialize.apply(this,arguments)};I.prototype={id:"",uri:"",isCss:!1,deps:null,source:null,readyState:0,initialize:function(e,i){this.track=d(this.track,this),s(e)?this.setSource(e):n(e)?(t(this,e),this.shim&&this.setDeps(this.shim.deps)):(this.uri=e,i&&(this.isCss=!0))},canStartLoad:function(){return this.shim?!this.hasDeps()||this.isDepsComplete():!0},define:function(e,t){s(e)?this.setSource(e):(this.setDeps(e),s(t)&&this.setSource(t))},exec:function(){if(!(this.readyState>=3))if(this.readyState=3,s(this.source)){var e=c(this.getDeps(),function(e){var t,i=z.getByName(e);return i&&(t=i.exports),t||{}});this.exports=this.source.apply(this,e)}else this.shim&&o(this.shim.exports)&&(this.exports=_[this.shim.exports])},getDeps:function(){return i(this.deps)?this.deps:[]},fireReady:function(){this.readyState>=2||(this.readyState=2,z.hndReady(this))},hasDeps:function(){return!!(this.getDeps().length>0)},isDepsComplete:function(){if(this._depsCompleted)return!0;var e=!0;return this.hasDeps()&&(u(this.getDeps(),function(t){var i=z.getByName(t);return!i||i.readyState<3?(e=!1,!1):void 0},this),e&&(this._depsCompleted=!0)),e},load:function(){if(this.source)this.isDepsComplete()?this.fireReady():this.loadDeps();else if(this.canStartLoad()){if(this.readyState>=1)return;this.readyState=1,q.load(this.uri,this.isCss,d(this.fireReady,this))}else this.loadDeps()},loadDeps:function(){this.isDepsComplete()||u(this.getDeps(),z.load,z)},setDeps:function(e){i(e)?this.deps=h(e,function(e){return o(e)}):o(e)&&(this.deps=[e])},setSource:function(e){s(e)&&(this.source=e,this.isDepsComplete()?this.fireReady():this.loadDeps())},track:function(t,i,s){return e.track(this.name,t,i,s||t)},toString:function(){return"[object orderjs.Module]"}};var $=/^(?!.+?\.(?:js|css)$)[^\/\?]*$/i,U=/^(?:(.+)>)?(?:(.+):)?(.+)$/i,Y=/([^:>]+:\/\/.+)|([^:>]*\.\/.+)|([^:>]*(?:\/|\?).+)|([^:\/>]+\.css$)|([^:\/>]+\.js$)/i,z=e.moduleMgr={_baseDeps:o(M)?[a(M)]:[],_config:{enableLAMD:!1,AMD:null,disableCache:!1,debugMode:!1,root:{js:y,css:y},shim:{},paths:{}},_moduleRoots:{},_modules:{},_normalOrderList:[],_orderList:[],_parsedNames:{},readyList:[],addBase:function(e){if(!this._baseDepsLoading||this._baseDepsComplete)return this.require.apply(this,arguments);var t=this._baseDeps,n=i(e)?e:arguments;u(n,function(e){(o(e)||s(e))&&t.push(e)}),this.require(t)},applyConfig:function(e){if(n(e)){var i=t({},e),s=this._config,r=i.root,a=s.root;if(o(r))a.js=a.css=p(r);else for(var u in r)a[u.toLowerCase()]=p(r[u]);delete i.root,t(s.paths,i.paths),delete i.paths,t(s.shim,i.shim),delete i.shim,t(s,i)}},config:function(e,t){var i=arguments.length;if(2==i){if(r(e)){var s={};s[e]=t,this.applyConfig(s)}}else if(1==i){if(r(e))return this._config[e];n(e)&&this.applyConfig(e)}},checkOrderListExec:function(){var e,t;if(T.isEmpty()){for(t=this._orderList;e=t[0];){if(!(e.readyState>=3))return void T.push(e);t.shift()}this._baseDepsLoading&&this.endRequireBase()}},create:function(t){var i;if(o(t)){t=a(t);var n,r=this.parseName(t),u=r.id,c=r.uri,h="css"==r.type,d=this._modules;o(u)&&(d[u]?i=d[u]:(n={id:u,uri:c,name:t,isCss:h,shim:this._config.shim[t]},i=d[u]=new I(n)))}else s(t)&&(i=new I(t));return i||e.debug(this+">create(): Invalid name = "+t,"err"),i},define:function(e,t,i){var s=this.getByName(e)||this.create(e);return s&&s.define(t,i),s},endRequireBase:function(){this._baseDepsLoading=!1,this._baseDepsComplete=!0,this._config.enableLAMD&&(t(_,{require:e,define:e.define}),t(_.define,{AMDType:"LAMD",AMD:t({},this._config.AMD)})),this.require(this._normalOrderList)},get:function(e){return this._modules[e]},getByName:function(e){return this.get(this.nameToId(e))},getModuleRoot:function(e,t){var i;return t=o(t)?a(t).toLowerCase():"js",o(e)&&(i=this._moduleRoots[a(e).toLowerCase()]),(i||this._config.root)[t]||""},hndReady:function(e){this.readyList.push(e),T.hndReady(e)},load:function(e){if(!e)return null;var t;return o(e)&&(t=this.getByName(e)),t||(t=this.create(e)),t&&t.load(),t},nameToId:function(e){return this.parseName(e).id},nameToType:function(e){return this.parseName(e).type},parseName:function(e){if(!r(e))return{};if(e=a(e),!o(e))return{};var i=this._config,s=this._parseName(e);return s.id||(s.id=s.uri),i.paths[e]&&t(s,this._parseName(i.paths[e])),s},regRootNS:function(e,t){if(o(e)){if(o(t))t={js:t,css:t};else if(!n(t))return;var i,s,r=this._parsedNames,a=this._moduleRoots;e=e.toLowerCase(),a[e]||(a[e]={}),i=a[e];for(var u in t)i[u.toLowerCase()]=p(t[u],this._config.root[u]);for(var u in r)s=this.parseName(u).rootNS,s&&s.toLowerCase()==e&&delete r[u]}},require:function(e){var t,s,n=i(e)?e:arguments;if(o(n[0])&&(s=this.getByName(n[0]),s&&(t=s.exports,1==n.length)))return t;if(this._baseDepsLoading){if(e!==this._baseDeps){var r=this._normalOrderList;return u(n,function(e){r.push(e)})}this._baseDeps=[]}return u(n,function(e){s=this.load(e),s&&s.readyState<3&&(this._orderList.push(s),this.checkOrderListExec())},this),t},startRequireBase:function(){if(!this._baseDepsComplete){if(0==this._baseDeps.length)return this.endRequireBase();this._baseDepsLoading=!0,this.require(this._baseDeps)}},_parseName:function(t){var i,s,n,r,u,c,h,d=this._parsedNames[t];return d?d:(d={},(i=t.match($))?(n=t.match(U))&&(r=a(n[3]||""),o(r)&&(d.type=u=n[1]||"js",d.rootNS=h=n[2],c=this.getModuleRoot(h,u),d.uri=c+r.replace(/\./g,"/")+"."+u)):(s=t.match(Y))&&(d.type=s[4]?"css":"js",d.uri=p(s[0],this._config.root[d.type])),d.uri?this._parsedNames[t]=d:e.config("debugMode")&&e.debug(this+">_parseName(): Invalid name = "+t),d)},toString:function(){return"[object orderjs.moduleMgr]"}};u(["define","require","addBase","regRootNS","config"],function(t){e[t]=d(z[t],z)}),t(e,{version:"0.9.8",orderjsNode:w,absolutizePath:p,noConflict:function(){_.orderjs=_.originalOrderjs},debug:D,dir:D,ready:l,track:D}),_.orderjs=e,z.startRequireBase()}).call(this);