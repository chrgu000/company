orderjs.define("gui.form.TimeSelect",["lib.data.Calendar","gui.form.Input","css>rl:inputs","gui.button.IconButton"],function(){rl.gui.form.TimeSelect=rl.createClass({parent:rl.gui.form.Input,construct:function(t){rl.isPrototyping(arguments[0])||rl.gui.form.TimeSelect.parent.call(this,t)},members:{format:"%H:%M:%S",dataSource:null,showSecond:!0,showMilliSecond:!1,spinnerDirection:"horizontal",_interactiveStateCssPrefix:"rl_timeselect_",_timeMethodNames:["Hours","Minutes","Seconds"],_batchUpdating:!1,_htmlTpl:new rl.HtmlTpl('<span id="{id}" class="rl_comp rl_input rl_timeselect {css}" title="{tip}"><label for="{ctrlId}" class="{labelCss}">{label}</label><span class="wrapper" id="{wrapperId}"><input id="{ctrlId}" />:<input />:<input />&nbsp;</span></span>'),initialize:function(){this.dw=new rl.dom.DomWrap,rl.isNonNullStr(this.id)||(this.id=this.autoId());var t=this.id;this.ctrlId=t+"_ctrl",this.wrapperId=t+"_wrapper",this.initDataSource(),rl.gui.compStore.add(this.id,this),this.autoRenderOnReady&&rl.onReady(Function.bind(this.render,this))},initDataSource:function(){var t=this.dataSource;t||(t=this.dataSource=new rl.data.Calendar,t.setHours(0,0,0,0)),t.on("change",this.hndDataChange,this)},render:function(t){if(this._rendered)return this;t=this.getRenderTarget(t);var e=this._htmlTpl.renderTo(t,{css:this.css+(this.alignRight?" rl_alignright":""),labelCss:this.labelCss,id:this.id,ctrlId:this.ctrlId,wrapperId:this.wrapperId,label:this.label,tip:this.tip},this.renderPosition);return this.dw.setTarget(e),this.initEvents(),this.initEles(),this.createScrollers(),this._rendered=!0,this.fireEvent("render"),this},initEvents:function(){var t=this.dw;t.on("keypress",this.hndKeyPress,this),t.on("keyup",this.hndKeyUp,this),t.on("mousewheel",this.hndMouseWheel,this)},initEles:function(){var t=this.dw.dom;this._inputEles=t.getElementsByTagName("input"),this._ctrlEle=this._inputEles[0],Array.each(this.initInputEle,this._inputEles,this),this._updateAllCtrlsValue()},initInputEle:function(t,e){var i=(this.dataSource,rl.$(t));t.setAttribute("maxlength",2),t._rl_innerTabIndex=e,rl.IE&&rl.VER_IE<7&&(t.style.border=0),i.on("focus",this.hndInputEleFocus,this),i.on("blur",this.hndInputEleBlur,this)},createScrollers:function(){this.createScroller("Minus"),this.createScroller("plus")},createScroller:function(t){t=t.capitalize();var e,i,s={_sizeCss:"scroller",renderTarget:this.wrapperId},r=rl.gui.mapImg,n="Minus"===t?"left":"right",l="scroller"+t+"Action",a="_startScroller"+t+"Action";rl.ext(s,{icon:r("inputs/arrow_"+n+".gif"),disabledIcon:r("inputs/arrow_"+n+"_disabled.gif"),action:Function.bind(this[l],this)}),e=this["scroller"+t]=new rl.gui.button.IconButton(s),e.render(),i=e.dw,i.on("mousedown",this[a],this),i.on("mouseout",this._stopScrollerAction,this),i.on("mouseup",this._stopScrollerAction,this)},setText:rl.gui.FN_ReturnThis,setValue:function(t){var e=this.value;if(e===t)return this;var i=this.dataSource,s=t.split(":"),r=i.getTime();return this._batchUpdating=!0,rl.isDefined(s[0])&&this.setHours(s[0]),rl.isDefined(s[1])&&this.setMinutes(s[1]),rl.isDefined(s[2])&&this.setSeconds(s[2]),this._batchUpdating=!1,i.getTime()!==r&&this._updateAllCtrlsValue(),t=i.format(this.format),t!==e&&this.hndChange(t,e),this},setFormat:function(t){var e=this.format;return e===t?this:(this.format=t,this.setValue(this.dataSource.format(t)),this)},setHours:function(t,e){var i=this.dataSource,s=i.getHours();return t%=24,s!==t&&t>=0&&(this._updatingData=!0,i.setHours(t),this._setHourCtrlValue(this.getHours(e)),this._updatingData=!1),this},getHours:function(t){var e=this.dataSource.getHours();return t&&10>e&&(e="0"+e),String(e)},setMinutes:function(t,e){var i=this.dataSource,s=i.getMinutes();return t%=60,s!==t&&t>=0&&(this._updatingData=!0,i.setMinutes(t),this._setMinuteCtrlValue(this.getMinutes(e)),this._updatingData=!1),this},getMinutes:function(t){var e=this.dataSource.getMinutes();return t&&10>e&&(e="0"+e),String(e)},setSeconds:function(t,e){var i=this.dataSource,s=i.getSeconds();return t%=60,s!==t&&t>=0&&(this._updatingData=!0,i.setSeconds(t),this._setSecondCtrlValue(this.getSeconds(e)),this._updatingData=!1),this},getSeconds:function(t){var e=this.dataSource.getSeconds();return t&&10>e&&(e="0"+e),String(e)},setWidth:function(t){return this.dw.setWidth(t),this},setHeight:rl.gui.FN_ReturnThis,disable:function(){return this.disabled?this:(this.disabled=!0,Array.each(this._disableCtrlEle,this._inputEles,this),this.scrollerMinus.disable(),this.scrollerPlus.disable(),this.displayStateChangedStyle(),this)},enable:function(){return this.disabled?(this.disabled=!1,Array.each(this._enableCtrlEle,this._inputEles,this),this.scrollerMinus.enable(),this.scrollerPlus.enable(),this.displayStateChangedStyle(),this):this},_disableCtrlEle:function(t){t&&(t.disabled=!0)},_enableCtrlEle:function(t){t&&(t.disabled=!1)},hndInputEleFocus:function(t){var e=rl.ew.init(t).getTarget();rl.$(e).isTag("input")&&(this._focusedTarget=this._ctrlEle=e,e.select(),this._startDetecting(),this.fireEvent("focus",t))},hndInputEleBlur:function(t){this._stopDetecting(),this._detectChange(),this._padCtrlEleValue(),delete this._focusedTarget,this.fireEvent("blur",t)},_padCtrlEleValue:function(){var t=this._ctrlEle,e=parseInt(t.value,10);isNaN(e)?e="00":10>e&&(e="0"+e),t.value=e},hndCtrlEleChange:function(){var t=this._ctrlEle,e=t._rl_innerTabIndex,i=parseInt(t.value,10),s=e>0?59:23;if(isNaN(i))t.value="";else{var r=this._timeMethodNames[e];i>s?i=s:0>i&&(i=0),i===parseInt(this["get"+r]())?t.value=i:this["set"+r](i)}},_detectChange:function(){var t=this._ctrlEle,e=t._rl_originalValue,i=t.value;i!==e&&this.hndCtrlEleChange()},hndKeyPress:function(t){var e=rl.ew.init(t);if(13==e.keyCode()){var i=e.getTarget();if(rl.$(i).isTag("input")){var s=i._rl_innerTabIndex,r=this._inputEles[s+1];rl.isElement(r)&&r.focus(),2==s&&this.fireEvent("inputfinish")}e.stopDefault(),this.fireEvent("enter")}},hndKeyUp:function(){this._detectChange()},hndMouseWheel:function(t){if(this._focusedTarget){var e=rl.ew.init(t),i=e.wheelDelta();0>i?this.scrollerPlusAction():i>0&&this.scrollerMinusAction(),e.stopEvent()}},hndDataChange:function(t,e){if(!this._batchUpdating){var i=this.dataSource,s=this.format,r=i.clone(e);this._updateAllCtrlsValue(),this.hndChange(i.format(s),r.format(s))}},hndChange:function(t,e){this.text=this.value=t,this.updateValueListener(),this.doAction(),this.fireEvent("change",t,e)},_updateAllCtrlsValue:function(){this._updatingData||(this._setHourCtrlValue(this.getHours(!0)),this._setMinuteCtrlValue(this.getMinutes(!0)),this._setSecondCtrlValue(this.getSeconds(!0)))},_setHourCtrlValue:function(t){var e=this._inputEles[0];e.value=e._rl_originalValue=t},_setMinuteCtrlValue:function(t){var e=this._inputEles[1];e.value=e._rl_originalValue=t},_setSecondCtrlValue:function(t){var e=this._inputEles[2];e.value=e._rl_originalValue=t},scrollerMinusAction:function(){this.doScrollerAction("minus")},scrollerPlusAction:function(){this.doScrollerAction("plus")},doScrollerAction:function(t){var e=this._ctrlEle,i=e._rl_innerTabIndex,s=parseInt(e.value,10),r=i>0?60:24;"plus"===t?s+=1:"minus"===t&&(s-=1),s==r?s=0:0>s&&(s=r-1),this["set"+this._timeMethodNames[i]](s,!0),rl.defer(function(){e.select()})},_startScrollerMinusAction:function(){this._startScrollerAction("Minus")},_startScrollerPlusAction:function(){this._startScrollerAction("Plus")},_startScrollerAction:function(t){var e="scroller"+t+"Action";this._scrllerActionTimer=Function.interval(this[e],200,this)},_stopScrollerAction:function(){window.clearInterval(this._scrllerActionTimer)},toString:function(){return"[object rl.gui.form.TimeSelect]"}}}),rl.gui.ctype2Classes.add("TimeSelect",rl.gui.form.TimeSelect)});