orderjs.define("gui.form.Validator",["lib.util.Range","gui.engine","gui.form.engine"],function(){rl.gui.form.Validator=rl.createClass({parent:rl.util.EventProvider,construct:function(r){rl.isPrototyping(arguments[0])||(rl.gui.form.Validator.parent.call(this,r),rl.ext(this,r),this.initialize(r))},members:{form:null,rules:null,initialize:function(){this._validateErrors=[]},validate:function(r){var e=rl.gui.form,t=e.Validator;if(r=e.getForm(r||this.form),!r)throw{description:this+" -> validate(): invalid form!"};this.clearItemValidationErrors();var i=!0;return Array.each(function(r){var e,n,a,e=r.name;if(rl.isNonNullStr(e)&&!r.disabled&&(n=this.rules[e],rl.isObject(n)&&(a=t.validateFormItem(r,n),a!==!0&&(this.addItemValidationError({src:r,rule:n}),i=!1),this.fireEvent(a===!0?"ipass":"ifail",r,n,e,a)===!1)))throw rl.BREAK_EACH},r.elements,this),this.fireEvent(i?"pass":"fail"),i},addRule:function(r,e){this.rules||(this.rules={});var t=this.rules;if(rl.isNonNullStr(r))t[r]=e;else if(rl.isObject(r))for(var i in r)this.addRule(i,r[i]);return this},addItemValidationError:function(r){this._validateErrors.push(r)},getItemValidationErrors:function(){return this._validateErrors},clearItemValidationErrors:function(){this._validateErrors.length=0},toString:function(){return"[object rl.gui.form.Validator]"}}}),function(){var r={required:/.+/,email:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,phone:/^((\(\d{3}\))|(\d{3}\-))?(\(0\d{2,3}\)|0\d{2,3}-)?[1-9]\d{6,7}$/,mobile:/^((\(\d{3}\))|(\d{3}\-))?13\d{9}$/,url:/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/,currency:/^\d+(\.\d+)?$/,number:/^\d+$/,zip:/^[1-9]\d{5}$/,qq:/^[1-9]\d{4,8}$/,integer:/^[-\+]?\d+$/,"double":/^[-\+]?\d+(\.\d+)?$/,english:/^[A-Za-z]+$/,chinese:/^[\u0391-\uFFE5]+$/,unsafe:/^(([A-Z]*|[a-z]*|\d*|[-_\~!@#\$%\^&\*\.\(\)\[\]\{\}<>\?\\\/\'\"]*)|.{0,5})$|\s/,ip:/^([1]\d\d|[2][0-5][0-5]|[1-9]\d|\d)\.([1]\d\d|[2][0-5][0-5]|[1-9]\d|\d)\.([1]\d\d|[2][0-5][0-5]|[1-9]\d|\d)\.([1]\d\d|[2][0-5][0-5]|[1-9]\d|\d)/,select:function(r,e){return rl.gui.form.Validator.validateSelect(r,e)},repeat:function(r,e){var t=!0,i=rl.getDom(e.to);return i&&r!=i.value&&(t="repeat"),t},compare:function(r,e){var t=!0,i=rl.getDom(e.to);if(i){var n=rl.util.comparisons,a=e.operator||"==";rl.isFunction(n[a])&&n[a](r,i.value)}return t}};rl.ext(rl.gui.form.Validator,{numberTypes:["number","double","integer"],validateFormItem:function(r,e){if(!r||r.disabled||!rl.isObject(e))return!0;var t=!0,i=rl.gui.form.Validator,n=i.getFormItemValue(r,e);if(rl.isEmpty(n))e.required&&(t="required");else{var a=(e.type||"").toLowerCase(),l=e.validation||i.getValidation(a);rl.isFunction(l)?t=l.call(null,n,e,r):(t=i.validateInput(n,e),0==t&&(t=a))}return t},validateSelect:function(r,e){if(!rl.isObject(e))return!0;var t=!0,i=(r||[]).length;if(i>0){var n=rl.gui.form.Validator,a=n.checkOverflow(i,e.min,e.max);a&&(t="select"+a)}else e.required&&(t="required_select");return t},validateInput:function(r,e){var t,i,n,a=!0,l=r.length,o=e.type,u=rl.gui.form.Validator,s=u.getValidation(o);return s instanceof RegExp&&(a=s.test(r),!a)?a:(u.isNumberType(o)?e.range?(t=u.checkRange(r,e.range),t&&(a="range"+t)):(i=e.min,n=e.max,t=u.checkOverflow(r,i,n),t&&(a="input"+t)):(i=e.minLength,n=e.maxLength,t=u.checkOverflow(l,i,n),t&&(a="input"+t+"Length")),a)},checkOverflow:function(r,e,t){var i=!1,n=e>r,a=r>t;return n?i="_min":a&&(i="_max"),i},checkRange:function(r,e){var t=!1,i=new rl.util.Range(e);return i.minCheck(r)||(t="_"+i.minOperator+"_min"),t||i.maxCheck(r)||(t="_max_"+i.maxOperator),t},getFormItemValue:function(r,e){if(!r)return void 0;var t,i=rl.gui.form;return rl.isObject(e)||(e={}),t=rl.isFunction(e.getValue)?e.getValue(r):i.getFormItemValue(r,e.ignoreFirstOption)},getErrMsg:function(r,e){var t,i=rl.gui.form.Validator.errMsgStore;return rl.isNonNullStr(r)||(r="unknown"),t=i[r.toLowerCase()]||"",t&&rl.isObject(e)&&(t=rl.format(t,e)),t},isNumberType:function(r){return rl.isNonNullStr(r)?Array.some(function(e){return r.equalsIgnoreCase(e)},rl.gui.form.Validator.numberTypes):void 0},getValidation:function(e){return rl.isNonNullStr(e)?r[e.toLowerCase()]:void 0},regValidation:function(e,t){if(rl.isNonNullStr(e))(rl.isFunction(t)||t instanceof RegExp)&&(r[e.toLowerCase()]=t);else if(rl.isObject(e))for(var i in e)arguments.callee.call(i,e[i])}});var e=rl.getG11nSource("rl.gui.form.Validator.errMsgStore");rl.gui.form.Validator.errMsgStore=rl.ext({},e)}()});