orderjs.define("gui.form.FollowedSelect",["lib.rpc.OneoffSdtHelperMgr","lib.dom.DomWrap"],function(){rl.createNamespace("rl.gui.form"),rl.gui.form.FollowedSelect=rl.createClass({construct:function(t){rl.isPrototyping(arguments[0])||(rl.ext(this,t),this.initialize())},members:{autoDecoOnReady:!0,autoUpdateOnDeco:!1,dataSource:null,dataUrl:"",dataUrlTag:"data-followerdata",master:null,masterList:null,servant:null,servantFollowedTag:"data-followed",servantFollowedTagValue:"followed",initialize:function(){rl.isObject(this.dataSource)||(this.dataSource={}),this.autoDecoOnReady&&rl.onReady(this.deco,this)},deco:function(){var t=this.master=rl.getDom(this.master),e=this.servant=rl.getDom(this.servant);if(!rl.$(t).isTag("select")||!rl.$(e).isTag("select"))throw{description:"Invalid selects!"};rl.$(t).on("change",this.hndMasterChange,this),e.setAttribute(this.servantFollowedTag,this.servantFollowedTagValue),rl.isNonNullStr(this.dataUrl)||this.dataUrl===!1||(this.dataUrl=t.getAttribute(this.dataUrlTag)),rl.isArray(this.masterList)&&this.setSelectOptions(t,this.masterList),this.autoUpdateOnDeco&&this.updateServant()},emptyServant:function(t){return this.setSelectOptions(this.servant,[{text:t||""}]),this},getListElementValue:function(t){var e;return t=rl.getDom(t),t&&t.options&&t.selectedIndex>-1?(e=t.options[t.selectedIndex],e.value||e.text):null},hndGetDataFailure:function(t,e,l){this.setSelectOptions(this.servant,[{text:l}])},hndGetDataSuccess:function(t,e,l,r){rl.debug(this+" data = "+r),rl.isArray(r)?(this.dataSource[t]=r,this.setSelectOptions(this.servant,r)):this.hndGetDataFailure(t,e,rl.getG11nSource("READ_DATA_ERR"))},hndMasterChange:function(){this.updateServant()},setSelectOptions:function(t,e,l){if(t=rl.getDom(t),rl.$(t).isTag("select")){var r;if(t.length=0,Array.each(function(e,l){r=new Option(e.text,e.value),t.options[l]=r,e.selected&&(r.selected=!0)},e),!l){var i=rl.gui.getFollowedSelect(t);rl.debug(this+" fselect = "+i+" element.id = "+t.id),i&&i.hndMasterChange()}return!0}},updateServant:function(){var t,e=this.dataUrl,l=this.dataSource,r=this.servant,i=this.getListElementValue(this.master);return rl.isEmpty(i)?this:(r&&(t=l[i],rl.isArray(t)?this.setSelectOptions(r,t):rl.isNonNullStr(e)&&(e+=(e.contains("?")?"":"?")+i,rl.rpc.sdtGet(e,rl.curry(rl.bind(this.hndGetDataSuccess,this),i),rl.curry(rl.bind(this.hndGetDataFailure,this),i)))),this)},toString:function(){return"[object rl.gui.form.FollowedSelect]"}}});var t=rl.gui.form.FollowedSelect,e=[];rl.ext(rl.gui,{followSelectTag:"data-follow",getFollowedSelect:function(t){return rl.find(e,function(e){return e&&rl.getDom(e.master)==rl.getDom(t)?!0:void 0})},docoFollowedSelects:function(l){var r,i=rl.filter(document.getElementsByTagName("select"),function(e){return e.type&&"select-one"==e.type.toLowerCase()&&e.getAttribute(rl.gui.followSelectTag)&&!e.getAttribute(t.prototype.servantFollowedTag)});rl.debug(this+" rl.gui.docoFollowedSelects(): found followers = "+i.length),rl.each(i,function(i){r=i.getAttribute(rl.gui.followSelectTag),rl.debug(this+" follower = "+i.id+" follow = "+r),rl.isNonNullStr(r)&&rl.$(r).isTag("select")&&e.push(new t(rl.fill({master:rl.getDom(r),servant:i},l)))})}})});