orderjs.define("gui.indicator.AutoUpdateProgressBar",["lib.rpc.engine","gui.engine","gui.indicator.ProgressBar","css>rl:indicator_bar"],function(){rl.gui.indicator.AutoUpdateProgressBar=rl.createClass({parent:rl.gui.indicator.ProgressBar,construct:function(){rl.isPrototyping(arguments[0])||rl.gui.indicator.AutoUpdateProgressBar.parent.apply(this,arguments)},members:{dataUrl:"",read:null,updateInterval:1,onInitialize:function(){this.initDataReader(),rl.gui.indicator.AutoUpdateProgressBar.parent.prototype.onInitialize.apply(this,arguments),rl.debug(this+" rl.gui.indicator.AutoUpdateProgressBar.parent.prototype.onInitialize = "+rl.gui.indicator.AutoUpdateProgressBar.parent.prototype.onInitialize)},initDataReader:function(){this.dataReader||(this.dataReader=this.createDataReader()),this.dataReader.on("read",this.updateOnRead,this)},createDataReader:function(){var t=new rl.util.EventProvider;if(rl.isFunction(this.read))t.start=this.read;else{t.httpRequest=this.createDataRequest(),t.read=function(){t.httpRequest.request()}}return t},createDataRequest:function(){return new rl.rpc.XHRequest({url:this.dataUrl,aysnc:!0,method:"get",responseType:"json",disableCache:!0,successHandler:Function.bind(this.hndDataRequestSuccess,this),failureHandler:Function.bind(this.hndDataRequestFailure,this)})},updateOnRead:function(){var t,e=this.dataReader,a=e.data;if(a&&a.total){var r=a.total,i=a.current;t=i>=r,this.updateContent(100*i/r)}rl.debug(this+" this.progress = "+this.progress),t?(this.completed=!0,e.fireEvent("complete")):this._readTimer=Function.delay(e.read,1e3*this.updateInterval,e)},startReading:function(){this.dataReader.read()},stopReading:function(){var t=this.dataReader,e=t.httpRequest;e.requesting&&e.abort(),window.clearTimeout(this._readTimer)},hndDataRequestSuccess:function(t,e){if(rl.isObject(t)&&t.total){var a=this.dataReader;a.data||(a.data={}),rl.ext(a.data,t),a.fireEvent("read")}else this.hndDataRequestSuccess(e)},hndDataRequestFailure:function(){this.dataReader.fireEvent("readerror")},toString:function(){return"[object rl.gui.indicator.AutoUpdateProgressBar]"}}}),rl.gui.ctype2Classes.add("AutoUpdateProgressBar",rl.gui.indicator.AutoUpdateProgressBar)});