orderjs.define("lib.dnd.BehaviorBase",["lib.dom.engine","lib.dom.DomWrap","lib.util.CustomUIEventsMgr"],function(){rl.createNamespace("rl.dnd",{absolutize:function(t,e,n){t=rl.getDom(t),rl.isElement(t)&&"absolute"!=rl.dom.getStyle(t,"position")&&(isNaN(e)&&(e=rl.dom.getOffsetX(t)),isNaN(n)&&(n=rl.dom.getOffsetY(t)),rl.dom.setStyle(t,{position:"absolute",height:t.offsetHeight+"px",width:t.offsetWidth+"px",left:e+"px",top:n+"px"}))}}),rl.dnd.BehaviorBase=rl.createClass({construct:function(t){rl.isPrototyping(arguments[0])||(rl.ext(this,t),this.initialize())},members:{dndStartTarget:null,useCapture:!0,_dndPreparing:!1,_dndStartDelayTimer:0,_dndStartDelay:1e3,eventNameOfB4Dnd:"beforednd",eventNameOfB4DndStart:"dndstart",eventNameOfDuringDnd:"dnding",eventNameOfDndEnd:"dndend",eventNameOfDnd:"dnd",initialize:function(){this._b4DndEventData={},rl.dom.addEventListener(window,"blur",this._hndDragCancel,this),this.regEvents()},b4Dnd:function(t){if(rl.debug("str = 123456"),!this._dndPreparing){this._dndPreparing=!0;var e=rl.ew.init(t),n=e.getTarget(),r=rl.util.CustomUIEventsMgr;try{if(r.fireTargetEvent(n,this.eventNameOfB4Dnd)===!1)return this.afterDnd()}catch(i){return rl.dir(i,this+" -> b4Dnd(): Error!"),this.afterDnd()}rl.IE?rl.ext(this._b4DndEventData,e.getEvt()):this._b4DndEventData=e.getEvt(),rl.dom.addEventListener(document,"mousemove",this.dndStart,this),rl.dom.addEventListener(document,"mouseup",this.dndEnd,this),this._dndStartDelayTimer=Function.delay(this.dndStart,this._dndStartDelay,this),this.dndStartTarget=n,this.useCapture&&(document.body.setCapture?document.body.setCapture():window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP))}},dndStart:function(t){var e=rl.ew,n=this.dndStartTarget,t=e.init(t).getEvt(),r=rl.util.CustomUIEventsMgr;t||e.init(this._b4DndEventData),rl.dom.removeEventListener(document,"mousemove",this.dndStart,this),clearTimeout(this._dndStartDelayTimer),rl.dom.addEventListener(document,"mousemove",this.duringDnd,this);try{r.fireTargetEvent(n,this.eventNameOfB4DndStart)}catch(i){return rl.dir(i,this+" -> dndStart(): Error!"),this.afterDnd()}},duringDnd:function(t){var e=(rl.ew.init(t),this.dndStartTarget),n=rl.util.CustomUIEventsMgr;try{n.fireTargetEvent(e,this.eventNameOfDuringDnd)}catch(r){return rl.dir(r,this+" -> duringDnd(): Error!"),this.afterDnd()}},dndEnd:function(t){var e=(rl.ew.init(t),this.dndStartTarget),n=rl.util.CustomUIEventsMgr;if(rl.isElement(e))try{n.fireTargetEvent(e,this.eventNameOfDndEnd),n.fireTargetEvent(e,this.eventNameOfDnd)}catch(r){return rl.dir(r,this+" -> dndEnd(): Error!"),this.afterDnd()}this.afterDnd()},afterDnd:function(){this._dndStarted=!1,this._dndPreparing=!1,this.dndStartTarget=null,this.useCapture&&(document.body.releaseCapture?document.body.releaseCapture():window.releaseEvents(Event.MOUSEMOVE|Event.MOUSEUP)),clearTimeout(this._dndStartDelayTimer),rl.dom.removeEventListener(document,"mousemove",this.dndStart,this),rl.dom.removeEventListener(document,"mousemove",this.duringDnd,this),rl.dom.removeEventListener(document,"mouseup",this.dndEnd,this)},_hndDragCancel:function(){if(this._dndPreparing)try{this.dndEnd()}catch(t){}},_regEvent:function(t){var e=rl.util.CustomUIEventsMgr,n=Function.bind(this.initTargetUIEvent,this),r=Function.bind(this.destructTargetUIEvent,this);e.regEvent(t,n,r),rl.debug("name = "+t)},regEvents:function(){var t=[this.eventNameOfB4Dnd,this.eventNameOfB4DndStart,this.eventNameOfDuringDnd,this.eventNameOfDndEnd,this.eventNameOfDnd];Array.each(this._regEvent,t,this)},initTargetUIEvent:function(t){rl.dom.addEventListener(t,"mousedown",this.b4Dnd,this)},destructTargetUIEvent:function(t){rl.dom.removeEventListener(t,"mousedown",this.b4Dnd,this)},toString:function(){return"[object rl.dnd.BehaviorBase]"}}})});