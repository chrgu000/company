/**
 * @fileOverview Console for debug.
 * @change
 	#1 by prcjack Creates file.
	#2 by prcjack @2013/10/14 Add deep dir support.
	#3 by prcjack @2013/10/21 Fix dir method options.all bug.
 */
orderjs.define("lib.util.console",["css>rl:console"],function(){rl.console=rl.util.console=function(){function r(){var r=0;for(var e in window)r++;return r}function e(){var r=[];for(var e in window)r.push(e);return r}function n(){var r=[];for(var e in window)s.contains(e)||rl.console.knownGlobalVarList.contains(e)||r.push(e);return r}function l(r){return r.replace(/(^\s+)|\s+$/g,"")}function o(r,e){return new RegExp("\\b"+l(e)+"\\b").test(r.className)}function t(r,e){o(r,e)||(r.className=l(r.className)+" "+e)}function i(r,e){var n=new RegExp("\\b"+l(e)+"\\b","gi");r.className=r.className.replace(n," ")}var s,a,c=null,u=rl._debugMsgStore||[],d=/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,f="",g={MSG:"rl_console_showmsg",WARN:"rl_console_showwarn",ERR:"rl_console_showerr",ALL:"rl_console_showall"},p={MSG:"rl_csl_msg",WARN:"rl_csl_warn",ERR:"rl_csl_err"},b={A:"all",D:"deep",F:"full"};return s=e(),a=r(),Function.delay(function(){rl.console.outputGlobalVarInfo(!0)},1e3),{knownGlobalVarList:["onerror"],initialize:function(){!c&&document.body&&(c=document.createElement("div"),c.className="rl_console "+g.ALL,f=g.ALL,document.body.appendChild(c),c.onkeypress=rl.console.hndKeyPress,c.tabIndex=1e4)},hndKeyPress:function(r){r=r||event;var e="",n=String.fromCharCode(r.keyCode||r.which).toLowerCase();switch(n){case"a":e="ALL";break;case"e":e="ERR";break;case"m":e="MSG";break;case"w":e="WARN"}e&&rl.console.filterMsg(e)},filterMsg:function(r){if(rl.isNonNullStr(r)){r=r.toUpperCase();var e=g[r];e&&f!==e&&(i(c,f),t(c,e),f=e),Function.defer(rl.console.scrollToEnd)}},outputMsgStore:function(){if(u.length){var r=Array.map(function(r){return rl.console.renderDebugInfo(r[0],r[1])},u).join("");u.length=0,rl.console.showDebugInfo(r)}},debug:function(r,e){return!c||rl.console.hidden?void u.push([r,e]):(r=rl.console.renderDebugInfo(r,e),void rl.console.showDebugInfo(r))},renderDebugInfo:function(r,e){e=String(e).toUpperCase(),p[e]||(e="MSG");var n=new Date,l=p[e]||"";return r="<div class='"+l+"'>&gt; rl "+e+" ["+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+" "+n.getMilliseconds()+"] "+r+"<br /></div>"},showDebugInfo:function(r){var e=document.createElement("span");c.appendChild(e),e.innerHTML=r,Function.delay(rl.console.scrollToEnd,100)},dir:function(r,e,n){if(n===!0)n={all:!0};else if(rl.isNonNullStr(n))if(n=n.toUpperCase().trim(),p[n])n={type:n};else{var l=n.replace(/[\s|\,]+/g," ").split(" ");n={},Array.each(function(r){var e=b[r];e&&(n[e]=!0)},l)}else n||(n={});var o=rl.console.getObjectDetail(r,e,n.all,n.deep,n.full);return rl.console.debug(o,n.type)},getObjectDetail:function(r,e,n,l,o){var t=[],i=rl.console,s=i.getItemDetail;if(t.push("<table class='rl_kvpairs' ><thead><caption>"+(e?e:i.summarize(String(r)||"&nbsp;"))+"</caption><tr><th>Property</th><th>Value</th></tr></thead>"),rl.isArray(r)||r&&r.callee)for(var a=0,c=r.length;c>a;a++)t.push(s(r,a,n,l,o));else if(rl.isElement(r))rl.each(r.attributes,function(r){if(r&&r.specified){var e={},i=String(r.nodeName);e[i]=String(r.nodeValue),t.push(s(e,i,n,l,o))}});else for(var a in r)t.push(s(r,a,n,l,o));return t.push("</table>"),t.join("")},getItemDetail:function(r,e,n,l,o){if(!r)return"";var t,i="",s=!1,a=rl.console,c=o?String:a.summarize;try{t=r[e],rl.isFunction(t)?rl.isArray(r)?i=c(t):n?i=c(t):s=!0:i=rl.isElement(t)?a.getDomDetail(t):rl.isObject(t)&&l?a.getObjectDetail(t,"",n,!1,o):c(t)}catch(u){i="<font color='red'>[Access denied!]"+(u.description||u.message)+"</font>"}return s?"":"<tr><td>"+e+"</td><td>"+i+"</td></tr>"},getDomDetail:function(r){if(!rl.isElement(r))return"";var e="",n={},l=r.attributes,o=rl.console,t=rl.IE?"[object HTML"+r.tagName+"Element]":String(r);return rl.IE&&(l=Array.filter(function(r){return r&&r.specified},l)),Array.each(function(r,e){n[r.nodeName||e]=String(r.nodeValue)},l),e=o.getObjectDetail(n,t)},summarize:function(r){var e=String(r),n=e.length,l=150;return n>l&&(e=e.substr(0,l)+" ..."),e},outputGlobalVarInfo:function(r){var e,n,l=rl.console.getGlobalVarInfo(r);if(!r||l.newGlobalVars.length){for(var o in l)e=l[o],rl.isArray(e)&&(n=e.slice(0),Array.each(function(r,e){n[e]=(e%10==9?"<br />":"")+r},e),l[o]=n);rl.console.dir(l,"New global vars detectd!",{type:r?"warn":"msg"})}},getGlobalVarInfo:function(l){var o=n();return l?{newGlobalVars:o}:{initCount:a,runtimeCount:r(),initList:s,newGlobalVars:newList,runtimeList:e()}},regGlobalVariant:function(r){if(rl.isNonNullStr(r)){var e=rl.console.knownGlobalVarList;return e.contains(r)||e.push(r),!0}},show:function(){c||rl.console.initialize(),c.style.visibility="visible",rl.console.hidden=!1,rl.console.outputMsgStore()},showOnReady:function(){rl.onReady(rl.console.show)},alertTotalLoadTime:function(){Function.delay(function(){rl.onReady(function(){alert("total load time = "+(new Date-rl.loadedStart-100))})},100)},hide:function(){return c?(rl.console.hidden=!0,void(c.style.visibility="hidden")):rl.console.initialize()},toggleVisible:function(){return c?void(rl.console.hidden?rl.console.show():rl.console.hide()):rl.console.show()},toggleDecriptor:function(r){var e=rl.getDom(r);rl.isElement(e)&&(e.style.display="none"==e.style.display?"block":"none")},fillTpl:function(r,e){return r.replace(d,function(r,n){var l=e[n];return void 0===l&&(l=""),l})},moduleDescriptorTpl:"<a class='desc_link' href='javascript:void(0);' title='Click to open module source ...' onclick='{onclick}'>{name}</a>",objDescriptorTpl:"<a class='desc_link' href='javascript:void(0)' title='Click to see detail ...' onclick='{onclick}'>{objName}</a>{descHtml}",track:function(r,e,n,l){var o,t=["@"],i=rl.console,s=i.fillTpl,a=rl.console.createObjDescr;if(rl.isObject(e)&&rl.isNonNullStr(n)&&(o=e[n]),o||(o=i.getTrackMethodBody()),rl.isNonNullStr(r)){var c=orderjs.moduleMgr.nameToId(r),u='window.open("'+c+'", "rlConsoleModuleSource");';t.push(s(i.moduleDescriptorTpl,{name:r,onclick:u}),"&nbsp;")}return rl.isObject(e)&&t.push(a(e,String(e)+".")),n=(n||"anonymous")+"():",t.push(o?a(o,n):n,"&nbsp;"),rl.isObject(l)&&t.push(a(l,"Error Object")),t.join("")},getTrackMethodBody:function(){return arguments.callee.caller?arguments.callee.caller.arguments.callee.caller.arguments.callee.caller.arguments.callee.caller:void 0},createObjDescr:function(r,e){var n=rl.isFunction(r)?"<pre>"+String(r)+"</pre>":rl.console.getObjectDetail(r,"",!1,rl.isArray(r),!0),l=rl.autoId("rl_descriptor_"),o="<div class='desc_ctn' id='"+l+"' style='display:none;'>"+n+"</div>",t='rl.console.toggleDecriptor("'+l+'");';return rl.console.fillTpl(rl.console.objDescriptorTpl,{objName:e||String(r),onclick:t,descHtml:o})},dirWindowError:function(r,e,n){var l={ErrorMsg:r,ErrorURL:e,ErrorLine:n,__rl_stack:rl.raisingErrStack.join("<br/>")};rl.raisingErr&&rl.isNonNullStr(rl.raisingErr.stack)&&(l.stack=rl.raisingErr.stack.replace(/@| at /g,"<br/>@")),rl.dir(l,r,{type:"err",full:!0})},reportOrderjs:function(){var r,e,n=orderjs.execStack.executedList,l=orderjs.moduleMgr.readyList,o=function(r){return r.name||(r.source?"[anonymous]"+String(r.source).substr(0,100):"")};r=Array.map(o,n),e=Array.map(o,l),rl.dir(r,"Module Execute Report"),rl.dir(e,"Module Ready Report")},scrollToEnd:function(){c.scrollTop=c.scrollHeight},toString:function(){return"[Object rl.console]"}}}(),document.onkeypress=function(r){r=r||event;var e=r.keyCode||r.which;switch(e){case 82:case 114:if(r.shiftKey){var n=r.target||r.srcElement;n&&n.tagName&&"input"!=n.tagName.toLowerCase()&&rl.console.toggleVisible()}}},orderjs.debug=rl.debug=rl.console.debug,orderjs.dir=rl.dir=rl.console.dir,orderjs.track=rl.console.track;var r=window.onerror;window.onerror=function(){try{rl.console.dirWindowError.apply(null,arguments)}catch(e){(r||rl.EMPTY_FUNCTION).apply(null,arguments)}finally{return!0}},rl.regGlobalVariant=rl.console.regGlobalVariant,rl.isNonNullStr(rl.config.projName)&&rl.regGlobalVariant(rl.config.projName),orderjs("lib.util.timer")});