orderjs.define("gui.deco",["lib.data.engine","lib.dom.engine","gui.engine"],function(){var e=!1,r=new rl.util.Event,t=[],n=[],a=[],o=new rl.data.IMap,u=new rl.data.IMap;rl.gui.deco=rl.ext(new rl.util.EventProvider,{enableAutoDecorate:!0,autoDestroyTarget:!0,defaultTags:["input","select","button","span"],addAutoDecoArea:function(){return e?(rl.debug(this+"->addAutoDecoArea(): Function should be called after autoDecorated!","warn"),!1):(t=t.concat(Array.slice(arguments)),!0)},addAutoDecoTarget:function(){return e?(rl.debug(this+"->addAutoDecoTarget(): Function should be called after autoDecorated!","warn"),!1):(n=n.concat(Array.slice(arguments)),!0)},getTargetsInArea:function(e){var r,t,n=[];if(rl.isNonNullStr(e)?t=rl.getDom(e):rl.isObject(e)&&(rl.isElement(e)||"function"==typeof e.getElementsByTagName?t=e:(t=rl.getDom(e.target),r=e.tag)),rl.isElement(t)){var a=rl.isNonNullStr(r)?r.split(/\s+/):rl.gui.deco.defaultTags;Array.each(function(e){var r=t.getElementsByTagName(e);Array.each(function(e){rl.isElement(e)&&rl.isNonNullStr(e.getAttribute("ctype"))&&n.push(e)},r)},a)}return n},onAutoDecorate:function(t,n){rl.isFunction(t)&&(e?t.call(n):r.addHandler(t,n))},unAutoDecorate:function(t,n){rl.isFunction(t)&&!e&&r.removeHandler(t,n)},decorateArea:function(e){var r=rl.gui.deco,t=r.getTargetsInArea(e);r.autoDestroyTarget=!1,Array.each(r.decorate,t),r.destroyDeprecatedTargets(),r.fireEvent("decorateArea",e)},decorate:function(e){if(rl.isNonNullStr(e)&&(e=rl.getDom(e)),!rl.isElement(e))return null;var r=e.getAttribute("ctype");if(!rl.isNonNullStr(r))return null;var t,n=rl.gui.deco,a=n.readCfg(e);if(!a)return null;t=rl.createComp(a);var o=n.doAutoDestroyTarget;return t._rendered?o(e):t.on("render",Function.curry(o,e)),t},readCfg:function(e){if(!rl.isElement(e))return null;var r=e.getAttribute("ctype");if(!rl.isNonNullStr(r))return null;var t=rl.gui.deco,n=t.readNodeAttrs(e)||{};if(rl.fill(n,{renderTarget:e,renderPosition:"beforebegin"}),e.hasChildNodes()){var a=t.getCfgReader(r);if(rl.isFunction(a)){var o=a(e);o&&(n=rl.fill(o,n))}}return n},readNodeAttrs:function(e){if(!rl.isElement(e))return null;var r={},t=rl.gui.deco,n=t._getNodeAttrValue,a=e.getAttribute("ctype"),o=t.getAttrNameMap(a)||{},u=function(e){return o[e.toLowerCase()]||e};return rl.IE?Array.each(function(t){var a=t.name,o=u(a);if(t.specified)if("style"==a)r[o]=e[a].cssText;else if("width"==a&&0==t.value){var l,i,c=e.outerHTML;e.removeAttribute("width"),i=e.outerHTML,Array.each(function(e){c=c.replace(e,"")},i.split(/\s+/));var l=c.match(/(?:=)(.*)/);r.width=l?l[1]:e.offsetWidth}else r[o]=n(e,t);else"value"==a&&rl.isNonNullStr(t.value)&&(r[o]=n(e,t))},e.attributes):Array.each(function(t){r[u(t.name)]=n(e,t)},e.attributes),r},_getNodeAttrValue:function(e,r){var t=r.value;if(rl.isNonNullStr(t)){var n,a=/^javascript:\s*?((?:.|\n)+)/i;if(t=t.trim(),n=t.match(a),n&&n[1])return new Function("return "+n[1]).call(e)}return t},getCfgReader:function(e){return o.get(e)},addCfgReader:function(e,r){if(rl.isObject(e))for(var t in e)rl.gui.deco.addCfgReader(t,e[t]);else rl.isFunction(r)&&rl.isNonNullStr(e)&&o.add(e,r)},getAttrNameMap:function(e){var r=u.get(e);return r||(r=rl.gui.deco.buildAttrNameMap(e)),r},buildAttrNameMap:function(e,r){if(!rl.isNonNullStr(e))return null;if(rl.isFunction(e)||(r=rl.gui.getCompType(e)),!rl.isFunction(r))return null;var t={},n=r.prototype;for(var a in n)t[a.toLowerCase()]=a;return u.add(e,t),t},doAutoDestroyTarget:function(e){l.autoDestroyTarget?rl.dom.destroyElements(e):l.removeTarget(e)},removeTarget:function(e){rl.dom.domWarehouse.appendChild(e),e.id&&e.removeAttribute("id"),a.push(e)},destroyDeprecatedTargets:function(){rl.dom.destroyElements(a),a=[]}});var l=rl.gui.deco;rl.addAutoDecoArea=l.addAutoDecoArea,rl.onAutoDeco=l.onAutoDecorate,l.addCfgReader({button:function(e){return{text:e.innerHTML}},combox:function(e){var r=Array.map(function(e){var r=rl.gui.deco.readNodeAttrs(e);return r.text=e.text,r},e.options);return{items:r}}}),rl.onReady(function(){Function.defer(function(){var a=rl.gui.deco;a.enableAutoDecorate&&(Array.each(a.decorateArea,t),Array.each(a.decorate,n),0==t.length&&0==n.length&&a.decorateArea(document.body),r.fire(),r.clear(),t=[],n=[],e=!0)})})});