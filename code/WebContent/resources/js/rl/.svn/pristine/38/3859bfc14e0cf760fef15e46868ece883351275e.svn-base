orderjs.define("gui.indicator.MsgBox",["css>rl:tips","lib.data.engine","lib.dom.engine","lib.dom.DomWrap","gui.engine","gui.indicator.IndicatorBase"],function(){var g11nSource=rl.getG11nSource("rl.gui.indicator.msgBoxMgr")||{};rl.gui.indicator.MsgBox=rl.createClass({parent:rl.gui.indicator.IndicatorBase,construct:function(t){rl.isPrototyping(arguments[0])||rl.gui.indicator.MsgBox.parent.call(this,t)},members:{msg:"",icon:"",buttons:null,autoFocus:1,modal:!1,left:"auto",top:"auto",autoRenderOnReady:!0,iniVisible:!0,useShim:void 0,_htmlTpl:new rl.HtmlTpl('<table class="rl_comp rl_roundedrect rl_msgbox" id={id} cellspacing="0" cellpadding="0" border="0"  style="visibility:{visibility}; left:{left}; top:{top};" ><tr><td class="nw">&nbsp;</td><td class="n">&nbsp;</td><td class="ne">&nbsp;</td></tr><tr><td class="w">&nbsp;</td><td class="c"><table class="c_layout" border=0 cellspacing=0 cellpadding=0><tr><td class="icon_wrapper"><img src="'+rl.gui.URL_BLANK_IMG+'" style="background-image: url({icon});" /></td><td class="c_msg" id="{wid}">{msg}</td></tr>{barHtml}</table></td><td class="e">&nbsp;</td></tr><tr><td class="sw">&nbsp;</td><td class="s">&nbsp;</td><td class="se">&nbsp;</td></tr></table>'),_barHtmlTpl:new rl.HtmlTpl('<tr id="{barId}"><td colspan="2" class="c_bar">{buttons}</td></tr>'),_btnHtmlTpl:new rl.HtmlTpl("<button>{text}</button>"),initialize:function(){rl.isNonNullStr(this.id)||(this.id=this.autoId());var t=this.id,i=this.icon,s=rl.gui.indicator.msgBoxMgr.iconLib;this.wid=t+"_w",this.barId=t+"_bar",this.dw=new rl.dom.DomWrap,this.dw.useVisibilityShow=!0,rl.isEmpty(this.useShim)&&(this.useShim=rl.gui.enableFloaterShim),rl.isNonNullStr(i)&&!i.contains(".")&&(this.icon=s.get(i)||i),this.zIndexMgr=rl.gui[this.modal?"modalDialogZIndexMgr":"dialogZIndexMgr"],this.onInitialize(),rl.gui.compStore.add(this.id,this),Function.defer(this._deferInits,this)},render:function(t){if(this._rendered)return this;t=this.getRenderTarget(t);var i,s,n=this.isHtmlContent,e=(n?this.content:"",this.iniVisible?"":"hidden"),o=rl.dom.addUnit;return s=rl.isArray(this.buttons)?this._barHtmlTpl.assign({barId:this.barId,buttons:this._getButtonsHtml()}):"",i=this._htmlTpl.renderTo(t,{id:this.id,wid:this.wid,msg:this.msg,icon:this.icon,visibility:e,left:o(this.left),top:o(this.top),barHtml:s},this.renderPosition),this.dw.setTarget(i),this.hidden=!this.iniVisible,this.initView(),this.initEvents(),this._rendered=!0,this.fireEvent("render"),this},setMsg:function(t){return rl.isNonNullStr(t)&&(rl.$(this.wid).setInnerHTML(t),this.useShim&&this.updateShimView()),this},alignTo:function(t,i,s){this.dw.alignTo(t,i,s),this.useShim&&this.updateShimView()},toViewportCenter:function(){var t=this._getViewportCenterPosition();return dw.setXY(t.left,t.top),this.useShim&&this.updateShimView(),this},updateShimView:function(){var t=this.shim;if(t){var i=this.dw;t.setLeft(i.getLeft()).setTop(i.getTop()).setWidth(i.getWidth()).setHeight(i.getHeight()).setZIndex(i.getZIndex(!0)-1)}return this},showModalLayer:function(){var t=this.modalLayer;t||(t=this.modalLayer=rl.gui.maskLayerPool.pull(),t.setZIndex(this.dw.getZIndex(!0)-2)),t.show()},hideModalLayer:function(){var t=this.modalLayer;t&&(t.hide(),rl.gui.maskLayerPool.push(t),delete this.modalLayer)},showShim:function(){this.shim||(this.shim=rl.gui.floaterShimPool.pull()),this.updateShimView(),this.shim.show()},hideShim:function(){var t=this.shim;t&&(t.hide(),delete this.shim,rl.gui.floaterShimPool.push(t))},setZIndex:function(t){var i=this._zIndex;return t=parseInt(t),i===t||isNaN(t)?this:(this._zIndex=t,this.dw.setStyle({zIndex:t}),this.useShim&&this.updateShimView(),this.modal&&this.modalLayer&&this.modalLayer.setZIndex(t-2),this)},getZIndex:function(){return this._zIndex},initView:function(){var t=(this.left,this.top,this._getViewportCenterPosition()),i=rl.IE&&rl.VER_IE<7;i&&this._applyImgFilter(),"auto".equalsIgnoreCase(this.left)&&this.dw.setLeft(t.left),"auto".equalsIgnoreCase(this.top)&&this.dw.setTop(t.top),this.zIndexMgr.add(this),this.iniVisible&&(this.buttons&&this.doAutoFocusOnButton(),this.useShim&&this.showShim(),this.modal&&this.showModalLayer())},initEvents:function(){this.buttons&&this._initButtonsEvents(),this.dw.on("mousedown",this.hndMousedown,this),this.on("show",this.hndShow,this),this.on("hide",this.hndHide,this)},_applyImgFilter:function(){function t(t){Array.each(i,t.cells)}function i(t){var i=s[t.className];rl.isNonNullStr(i)&&(t.style.filter=i)}var s={},n='progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src="'+rl.gui.mapImg("tips/{file}")+'")';Array.each(function(t){var i="trans_"+t+".png";s[t]=n.replace(/{file}/,i)},"nw n ne e se s sw w".split(" ")),Array.each(t,this.dw.dom.rows)},_getViewportCenterPosition:function(){var t=this.dw,i=t.getWidth(),s=t.getHeight(),n=rl.dom.viewport,e=n.getHeight(),o=n.getWidth(),r=(e-s)/2,a=(o-i)/2;return{left:a,top:r}},_getButtonsHtml:function(){var t=rl.gui.indicator.msgBoxMgr.defaultButtonSpacing;return Array.map(function(i,s){var n=this._btnHtmlTpl.assign({text:i.text});return s>0&&(n="&nbsp;".times(i.spacing||t)+n),n},this.buttons,this).join("")},doAutoFocusOnButton:function(){Function.defer(this._focusOnButton,this,this.autoFocus)},_focusOnButton:function(t){var i=this.getButton(t);i&&i.focus()},getButton:function(t){var i=rl.getDom(this.barId);if(!rl.isElement(i))return null;var s=i.getElementsByTagName("button"),n=t>0?t-1:t?1:-1;return n>-1?Array.find(function(t,i){return i==n},s,this):null},_initButtonsEvents:function(){var t=rl.getDom(this.barId);if(rl.isElement(t)){var i=t.getElementsByTagName("button");Array.each(function(t,i){rl.$(t).on("click",Function.bind(this.hndButtonClick,this,i))},i,this)}},hndMousedown:function(){this.zIndexMgr.bringFrontest(this)},hndShow:function(){this.buttons&&this.doAutoFocusOnButton(),this.useShim&&this.showShim(),this.modal&&this.showModalLayer()},hndHide:function(){this.useShim&&this.hideShim(),this.modal&&this.hideModalLayer()},hndButtonClick:function(index){var cancelDefault=!1,btnCfg=this.buttons[index];if(btnCfg){var action=btnCfg.action;rl.isFunction(action)?cancelDefault=action():rl.isNonNullStr(action)&&(cancelDefault=eval(action))}cancelDefault||this.doDefaultAction()},doDefaultAction:function(){this.hide()},onDispose:function(){this.useShim&&this.hideShim(),this.modal&&this.hideModalLayer(),this.zIndexMgr.remove(this),this.dw.dispose()},toString:function(){return"[object rl.gui.indicator.MsgBox]"}}}),rl.gui.ctype2Classes.add("MsgBox",rl.gui.indicator.MsgBox),rl.createNamespace("rl.gui.indicator.msgBoxMgr",function(){var t=new rl.data.IMap,i=rl.gui.mapImg;return t.add({info:i("tips/info.gif"),question:i("tips/question.gif"),warn:i("tips/warn.gif"),error:i("tips/error.gif"),check:i("tips/check.gif")}),{defaultButtonSpacing:4,iconLib:t,okButtonText:g11nSource.okText||"OK",cancelButtonText:g11nSource.cancelText||"Cancel",showAlert:function(t,i){var s=rl.gui.indicator.msgBoxMgr,n={msg:t,modal:!0,icon:"warn",buttons:[{text:s.okButtonText,action:i}]};return new rl.gui.indicator.MsgBox(n)},showConfirm:function(t,i,s){var n=rl.gui.indicator.msgBoxMgr,e={msg:t,modal:!0,icon:"question",buttons:[{text:n.okButtonText,action:i},{text:n.cancelButtonText,action:s}]};return new rl.gui.indicator.MsgBox(e)},showMsg:function(t,i,s){var n=rl.gui.indicator.msgBoxMgr,e={modal:s===!1?!1:!0,icon:"info",buttons:[{text:n.okButtonText,action:i}]};return rl.isNonNullStr(t)?e.msg=t:rl.isObject(t)&&rl.ext(e,t),new rl.gui.indicator.MsgBox(e)}}}())});