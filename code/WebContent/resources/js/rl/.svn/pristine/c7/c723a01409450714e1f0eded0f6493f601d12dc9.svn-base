/**
 * @fileOverview Module for pages communication to form a opoa.
 *  include this file in every sub page.
 * @change
 	#1 by prcjack Creates file.
 */
orderjs.define("app.opoa.page",["lib.dom.engine","lib.dom.DomWrap","gui.engine"],function(){function r(r){var e=Array.slice(arguments,1);try{var n=s._frameWrapper;if(rl.isObject(n))return n[r]?n[r].apply(n,e):void 0}catch(t){rl.dir(t,"callFrameWrapperMethod error")}try{if(window[r])return window[r].apply(window,e)}catch(t){rl.dir(t,"error on call window["+r+"]",{type:"err"})}}function e(r){var e=Array.slice(arguments,1),n=s.messageMgr;return n&&rl.isFunction(n[r])?n[r].apply(n,e):void rl.debug(this+"-> "+r+"(): Invalid page msg mgr = "+n,"warn")}function n(r){if(rl.isString(r)&&(r=r.trim()),rl.isNonNullStr(r)){var e,n,t,o={};return Array.each(function(r){r=r.trim(),rl.isNonNullStr(r)&&(r.contains("")?(e=r.split("="),n=(e[0]||"").trim(),t=(e[1]||"").trim(),o[n]=t):o[r]=!0)},r.split(",")),o}}function t(r){if(rl.isString(r))return r;var e=[];if(rl.isObject(r))for(var n in r)e.push(n+" = "+r[n]);return e.join(",")}function o(r){var e=r;if(rl.isNonNullStr(e)){var n=e.match(p);n&&(e=n[1]),n=e.match(f),n&&(e=n[1])}else e="about:blank";return e}rl.createNamespace("rl.opoa",{page:new rl.util.EventProvider}),rl.opoa.page.toString=function(){return"[object rl.opoa.page]"};var i,a,l,u,s=rl.opoa.page,c=rl.getTopRLWindow(),g=["_self","_top","_parent"];if(rl.ext(s,{_frameWrapper:null,defaultPageIcon:rl.gui.mapIcon("page.gif").replace(/(?!:)(.)\/{2,}/g,"$1/"),defaultPageLoadingIcon:rl.gui.mapIcon("wait.gif").replace(/(?!:)(.)\/{2,}/g,"$1/"),autoTitle:!0,autoIcon:!0,iconLinkRel:"rl-page-icon",open:window.open,openTab:function(r,e,n){return rl.isNonNullStr(n)?n+=",type=tab":rl.isObject(n)?n.type="tab":n={type:"tab"},s.open.call(s,r,e,n)},openDialog:function(r){var e=rl.fill({type:"window"},r),n=e.url||e.content,t=e.name;return delete e.url,delete e.name,s.open(n,t,e)},getOpener:function(){var r=null,e=s._frameWrapper;if(e&&(r=e._opener,!r)){var n=e._openerFrameElement;n&&(r=n.contentWindow)}return r||window.opener},close:Function.curry(r,"close"),resizeTo:Function.curry(r,"resizeTo"),adjustFrameOnReady:function(r){rl.onReady(function(){Function.defer(rl.page.adjustFrame,null,r)})},adjustFrame:function(r){var e,n;r=rl.getDom(r),rl.isElement(r)?(e=r.offsetWidth,n=r.offsetHeight):(r=document.body,e=r.scrollWidth+18,n=r.scrollHeight+18),rl.page.resizeTo(e,n)},focus:Function.curry(r,"focus"),blur:Function.curry(r,"blur"),reload:function(){return window.location.reload()},_notifyParent:function(r,e,n){var t,o,i=window.parent;if(rl.debug(this+" _notifyParent(): property = "+r+" value = "+e),i!=window){if(t=i.rl,!t)return;o=t.page,o&&rl.isFunction(o.fireEvent)&&o.fireEvent("subpagepropertychange",window.frameElement,r,e,n)}},showMsg:Function.curry(e,"showMsg"),showAlert:Function.curry(e,"showAlert"),showConfirm:Function.curry(e,"showConfirm"),setMessageMgr:function(r){s.messageMgr=r,r&&rl.isFunction(r.showMsg)&&rl.isFunction(r.showAlert)&&rl.isFunction(r.showConfirm)||rl.debug(this+"-> setMessageMgr(): Invalid msg mgr = "+r,"warn")},getProgress:function(){return l},setProgress:function(r){if(r=100-parseInt(r)%100,isNaN(r)||l===r)return s;var e=l;return l=r,s.fireEvent("propertychange","progress",r,e),s._notifyParent("progress",r,e),s},getStatus:function(){return a},setStatus:function(r){if(a===r)return s;var e=a;return a=r,s.fireEvent("propertychange","status",r,e),s._notifyParent("status",r,e),s},getIcon:function(){return u},setIcon:function(r){if(u===r)return s;var e=u;return u=r,s.fireEvent("propertychange","icon",r,e),s._notifyParent("icon",r,e),s},getTitle:function(){return i},setTitle:function(r){if(i===r)return s;var e=i;return i=r,s.fireEvent("propertychange","title",r,e),s._notifyParent("title",r,e),s}}),c==window){var p=/([^?]+?)\?/,f=/[^\/]+\/([^/]+\.[^/]+)/;rl.ext(s,{_frameWrapperMgrs:{},autoFrameNamePrefix:"rl_frame_name_",setWindowsMgr:function(r){rl.isObject(r)&&rl.isFunction(r.findItemByPageElement)?s._frameWrapperMgrs.windowsMgr=r:rl.debug("Invalid obj for page windowsMgr = "+r,"warn")},getWindowsMgr:function(){return s._frameWrapperMgrs.windowsMgr},setTabsMgr:function(r){rl.isObject(r)&&rl.isFunction(r.open)&&rl.isFunction(r.findItemByPageElement)?s._frameWrapperMgrs.tabsMgr=r:rl.debug("Invalid obj for page tabsMgr = "+r,"warn")},getTabsMgr:function(){return s._frameWrapperMgrs.tabsMgr},open:function(r,e,i){rl.isString(r)&&(r=r.trim()),rl.isNonNullStr(r)||(r="about:blank",arguments[0]=r);var a,l,u,c=s._frameWrapperMgrs,p=c.windowsMgr,f=c.tabsMgr;if(rl.isNonNullStr(i)&&(l=i,i=n(i)),a=(i||{}).type,!g.contains(e)){e=rl.isString(e)?e.trim().toLowerCase():"",e&&"_blank"!==e?u=p&&p.findItemByPageName(e)?p:f&&f.findItemByPageName(e)?f:null:(e=rl.autoId(s.autoFrameNamePrefix),arguments[1]=e),u||(u="tab".equalsIgnoreCase(a)?c.tabsMgr:c.windowsMgr);try{if(u&&rl.isFunction(u.open)){var d=s.defaultPageLoadingIcon;i?rl.isNonNullStr(i.icon)||(i.icon=d):i={icon:d},rl.isNonNullStr(i.title)||(i.title=o(r));var m=u.open.apply(u,arguments);return m._opener=window,m}}catch(w){rl.dir(w,"page open error")}}return rl.isObject(i)?i=t(i):l&&(i=l),window.open(r,e,i)},getFrameWrapper:function(r){var e,n=s._frameWrapperMgrs;for(var t in n)if(e=n[t].findItemByPageElement(r))return e}})}else if(c){{var d=c.rl.page,m=rl.dom.addEventListener;rl.dom.removeEventListener}if(d){var w=d.getFrameWrapper(window.frameElement);rl.ext(s,{_frameWrapper:w,open:function(r,e,n){if(g.contains(e))return window.open(r,e,n);var t=d,o=t.open.apply(t,arguments);try{var i=window.frameElement;o._openerFrameElement=i,i&&delete o._opener}catch(a){}return o}}),w&&rl.isFunction(w.hndPagePropertyChange)&&s.on("propertychange",w.hndPagePropertyChange,w)}s.setStatus("init"),rl.onReady(function(){if(s.setStatus("ready"),s.autoTitle&&s.setTitle(document.title),s.autoIcon){var r,e;Array.each(function(n){if(e=n.getAttribute("rel")||"",e&&e.trim().equalsIgnoreCase(s.iconLinkRel))throw r=n.href,rl.BREAK_EACH},document.getElementsByTagName("link")),rl.isNonNullStr(r)||(r=s.defaultPageIcon),s.setIcon(r),rl.debug(s+" Auto set icon = "+r)}}),m(window,"load",function(){s.setStatus("load")}),m(window,"unload",function(){s.setStatus("unload")})}rl.page=rl.opoa.page});