orderjs.define("gui.DatePicker",["lib.data.Calendar","gui.engine","gui.button.IconButton","gui.form.TimeSelect","gui.CalendarView","gui.menu.ToolBar","css>rl:datepicker"],function(){rl.gui.DatePicker=rl.createClass({parent:rl.gui.CalendarView,construct:function(t){rl.isPrototyping(arguments[0])||rl.gui.DatePicker.parent.call(this,t)},members:{useAnimation:!1,iniVisible:!1,showTime:!1,embedded:!1,ymCtrlTextFormat:(rl.getG11nSource("rl.gui.DatePicker")||{}).ymCtrlTextFormat||"{year}-{month}",_deferRenderTimeSelect:!0,_ymPaneVisible:!1,_htmlTpl:new rl.HtmlTpl('<div class="rl_datepicker" id="{id}" style="visibility:{visibility}; width:200px; height:215px;"><table class="head" cellspacing="0" cellpadding="0"><tr><td class="ymctrl_ctn"><a href="javascript:void(0);" hidefocus title="{ymctrlTip}" id="{ymctrlId}"><span></span>&nbsp;<img align="bottom" src="'+rl.gui.mapImg("calendar/ymctrl_down.gif")+'" /></a></td><td class="navbar" id="{navbarId}"></td></tr></table><div class="body"><table id="{dayPaneId}" class="day_pane" cellspacing="0" cellpadding="0">{dayNameGrid}{dayGrid}</table><table class="bottombar" cellspacing="0" cellpadding="0"><tr><td class="timeselect_ctn" id="{timeSelectCtnId}"></td><td class="okctrl"><a href="javascript:void(0);" hidefocus title="{okctrlTip}" id="{okctrlId}">&nbsp;</a></td></tr></table><div class="ym_pane" id="{ymPaneId}"><table class="y_pane" id="{yearPaneId}" border="0" cellspacing="0" cellpadding="0">{yearGrid}</table><div class="sep_line"></div><table class="m_pane" id="{monthPaneId}" border="0" cellspacing="0" cellpadding="0">{monthGrid}</table></div></div></div>'),initialize:function(){this.dw=new rl.dom.DomWrap,this.dw.useVisibilityShow=!0,this.initDataSource(),this._yearPaneYears=this._getYearPaneYears(),rl.isNonNullStr(this.id)||(this.id=this.autoId());var t=this.id;this.ymctrlId=t+"_ymctrl",this.navbarId=t+"_navbar",this.dayPaneId=t+"_dayPane",this.ymPaneId=t+"_ymPane",this.yearPaneId=t+"_yearPane",this.monthPaneId=t+"_monthPane",this.okctrlId=t+"_okctrl",this.timeSelectCtnId=t+"_timeSelectCtn",rl.gui.compStore.add(this.id,this),this.autoRenderOnReady&&rl.onReady(Function.bind(this.render,this))},render:function(t){if(this._rendered)return this;t=this.getRenderTarget(t);var e,i=this.iniVisible?"":"hidden",n=rl.gui.DatePicker.tips;return e=this._htmlTpl.renderTo(t,{id:this.id,ymctrlId:this.ymctrlId,navbarId:this.navbarId,dayPaneId:this.dayPaneId,ymPaneId:this.ymPaneId,yearPaneId:this.yearPaneId,monthPaneId:this.monthPaneId,timeSelectCtnId:this.timeSelectCtnId,okctrlId:this.okctrlId,dayNameGrid:this.createDayNameGrid(),dayGrid:this.createDayGrid(),yearGrid:this.createYearGrid(),monthGrid:this.createMonthGrid(),visibility:i,ymctrlTip:n.ymCtrl,okctrlTip:n.ok},this.renderPosition),this.dw.setTarget(e),this.hidden=!this.iniVisible,this.initEles(),this.initEvents(),this.updateDayNameCells(),this.updateDayCells(),this.updateYMCtrl(),this.createNavBar(),this.showTime&&this.initTimeSelect(),this.useAnimation&&this.initAnimation(),this._rendered=!0,this.fireEvent("render"),this},_createGrid:function(t,e,i){var n='<td><a hideFocus href="javascript:void(0);"></a></td>';i&&(n=n.replace("td","th"));var a=n.times(e);return("<tr>"+a+"</tr>").times(t)},createNavBar:function(){var t=rl.gui.mapImg,e=this.dataSource,i=rl.gui.DatePicker.tips,n={ctype:"IconButton",sizeType:16,disabled:!1,showNormalStateBorder:!1};this.navBar=new rl.gui.menu.ToolBar({renderTarget:this.navbarId,hndItemActionEvent:null,items:[new rl.gui.menu.MenuSplit(5),rl.fill({id:this.navbarId+"navPrev",tip:i.navPrevMonth,icon:t("calendar/arrow_left.gif"),disabledIcon:t("calendar/arrow_left_disabled.gif"),action:Function.bind(this.navPrevBtnAction,this)},n),rl.fill({id:this.navbarId+"navNext",tip:i.navNextMonth,icon:t("calendar/arrow_right.gif"),disabledIcon:t("calendar/arrow_right_disabled.gif"),action:Function.bind(this.navNextBtnAction,this)},n),new rl.gui.menu.MenuSplit(20),rl.fill({id:this.navbarId+"navToday",tip:i.navToday,iniVisible:e.getMonth()!==(new Date).getMonth(),icon:t("calendar/arrow_back.gif"),disabledIcon:t("calendar/arrow_back_disabled.gif"),action:Function.bind(this.navTodayBtnAction,this)},n)]})},initTimeSelect:function(){if(!this.timeSelect){var t=this.timeSelect=this.createTimeSelect();t.on("focus",this.hndTimeSelectFocus,this),t.on("blur",this.hndTimeSelectBlur,this),this._deferRenderTimeSelect?Function.defer(t.render,t):t.render()}},createTimeSelect:function(){return new rl.gui.form.TimeSelect({renderTarget:this.timeSelectCtnId,dataSource:this.dataSource})},initAnimation:function(){this._ymPaneAni||(this._ymPaneAni=this.createYMPaneAni())},createYMPaneAni:function(){return new rl.fx.Animation({duration:300,useSeconds:!1,easingType:"Cubic",easingDetails:"easeInOut",attributes:null,target:this.ymPaneId})},initEvents:function(){this.dw.on("mousewheel",this.hndMouseWheel,this),this.dw.on("contextmenu",this.hndContextMenu,this),rl.$(this.dayPaneId).on("click",this.hndDayPaneClick,this),rl.$(this.monthPaneId).on("click",this.hndMonthPaneClick,this),rl.$(this.yearPaneId).on("click",this.hndYearPaneClick,this),rl.$(this.ymctrlId).on("click",this.hndYMCtrlClick,this),rl.$(this.okctrlId).on("click",this.hndOKCtrlClick,this)},initEles:function(){var t=rl.getDom(this.dayPaneId);this.dayCells=t.getElementsByTagName("td"),this.dayNameCells=t.getElementsByTagName("th"),this.yearCells=rl.getDom(this.yearPaneId).getElementsByTagName("td"),this.monthCells=rl.getDom(this.monthPaneId).getElementsByTagName("td")},_updateDayCell:function(t,e,i){var n=this._getDayCellViewDetail(t,e,i),a=this.dayCells[t];a&&n&&(a.firstChild.innerHTML=n.content,a.className=n.css,a._rl_dateValue=e)},_updateMonthCell:function(t,e){var i=this._getMonthCellViewDetail(e);t.firstChild.innerHTML=i.content,t.className=i.css,t._rl_dateValue=i.dateValue},_updateYearCell:function(t,e){var i=this._getYearViewDetail(e);t.firstChild.innerHTML=i.content,t.className=i.css,t._rl_dateValue=i.dateValue},updateYMCtrl:function(){var t=this.dataSource,e=rl.getDom(this.ymctrlId).firstChild,i=t.getFullYear(),n=t.getMonth()+1;1>i&&(i="B.C. "+(1-i)),e.innerHTML=rl.format(this.ymCtrlTextFormat,{year:i,month:n})},_setNavStep:function(t){this._navStep=t,this.updateNavBtnsTip()},updateNavBtnsTip:function(){var t="Month",e=this._navStep,i=this.navBar,n=rl.gui.DatePicker.tips,a=i.getItemById(this.navbarId+"navPrev"),r=i.getItemById(this.navbarId+"navNext");e===Date.DECADE&&(t="Decade"),a.setTip(n["navPrev"+t]),r.setTip(n["navNext"+t])},show:function(){return this.hidden?(this.dw.show(),this.hidden=!1,this.fireEvent("show"),this):this},showYMPane:function(){if(this._ymPaneVisible)return this;if(this.updateYearCells(),this.updateMonthCells(),this._setNavStep(Date.DECADE),this.useAnimation)this.aniShowYMPane();else{var t=rl.getDom(this.ymPaneId);rl.$(t).setTop(0)}return this._ymPaneVisible=!0,this},hideYMPane:function(){if(!this._ymPaneVisible)return this;if(this.updateDayCells(),this._setNavStep(Date.MONTH),this.useAnimation)this.aniHideYMPane();else{var t=rl.getDom(this.ymPaneId);rl.$(t).setTop(-t.offsetHeight)}return this._ymPaneVisible=!1,this},toggleYMPane:function(){this._ymPaneVisible?this.hideYMPane():this.showYMPane()},aniShowYMPane:function(){this.slideYMPane("down")},aniHideYMPane:function(){this.slideYMPane("up")},slideYMPane:function(t){var e,i=this._ymPaneAni;i.animated&&i.stop(),"up"===t?e=-rl.getDom(this.ymPaneId).offsetHeight:"down"===t&&(e=0),rl.isEmpty(e)||(i.attributes={top:{to:e}},i.start())},showAt:function(t,e,i){this.dw.setXY(t,e,i),this.show()},hide:function(){return this.hidden?this:(this.dw.hide(),this.hidden=!0,this.hideYMPane(),this.fireEvent("hide"),this)},navPrevBtnAction:function(){var t=this._navStep,e=this.dataSource;return t===Date.DECADE&&1===e.getFullYear()?void e.add(Date.YEAR,-9):void e.previous(t)},navNextBtnAction:function(){var t=this._navStep,e=this.dataSource;return t===Date.DECADE&&0===e.getFullYear()?void e.add(Date.YEAR,9):void e.next(t)},navTodayBtnAction:function(){var t=this.dataSource;t.goToday()},_startFiringSelectEvent:function(){this._selectEventFiring||(this._selectEventFiring=!0,Function.delay(this._fireSelectEvent,300,this),this.fireEvent("startfiringselect"))},_fireSelectEvent:function(){this.fireEvent("select"),this._selectEventFiring=!1},hndDayPaneClick:function(t){var e=rl.ew.init(t).getTarget(),i=rl.$(e).upto(this._isDayCell,this);if(i){var n=this.dataSource,a=Array.indexOf(function(t){return i===t},this.dayCells),r=i._rl_dateValue;a>27&&15>r?this.navNextBtnAction():15>a&&r>15?this.navPrevBtnAction():n.getDate()===r?this.fireEvent("select"):(n.setDate(r),this.updateDayCells())}},hndMouseWheel:function(t){if(this._seletingTime)this.timeSelect.hndMouseWheel(t);else{var e=rl.ew.init(t).wheelDelta();e>0?this.navPrevBtnAction():0>e&&this.navNextBtnAction(),rl.ew.stopEvent()}},hndContextMenu:function(t){rl.gui.autoStopContextmenu(t)},hndMonthPaneClick:function(t){var e=rl.ew.init(t).getTarget(),i=rl.$(e).upto(this._isMonthCell,this);if(i){var n=this.dataSource,a=i._rl_dateValue,r=n.getMonth();r===a?this.hideYMPane():n.add(Date.MONTH,a-r)}},hndYearPaneClick:function(t){var e=rl.ew.init(t).getTarget(),i=rl.$(e).upto(this._isYearCell,this);if(i){var n=this.dataSource,a=Array.indexOf(function(t){return i===t},this.yearCells),r=i._rl_dateValue;0===a?this.navPrevBtnAction():11===a?this.navNextBtnAction():n.getDate()===r?this._startFiringSelectEvent():n.getFullYear()===r?this.hideYMPane():n.setFullYear(r)}},hndOKCtrlClick:function(){this.fireEvent("select")},hndYMCtrlClick:function(){this.toggleYMPane()},hndTimeSelectFocus:function(){this._seletingTime=!0},hndTimeSelectBlur:function(){this._seletingTime=!1},hndDataMonthChange:function(){this._rendered&&(this.updateYMCtrl(),this.updateNavTodayBtn(),this._ymPaneVisible?this.updateMonthCells():this.updateDayCells())},updateNavTodayBtn:function(){var t=this.navBar.getItemById(this.navbarId+"navToday"),e=this.dataSource,i=new Date,n=!(e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth());t.setVisible(n)},_isDayCell:function(t){return this._dateValueInjected(t)},_isMonthCell:function(t){return this._dateValueInjected(t)},_isYearCell:function(t){return this._dateValueInjected(t)},_dateValueInjected:function(t){return t&&!rl.isEmpty(t._rl_dateValue)},toString:function(){return"[object rl.gui.DatePicker]"}}}),rl.gui.ctype2Classes.add("DatePicker",rl.gui.DatePicker),rl.gui.DatePicker.Pool=function(){var t=[],e=[];return{pull:function(i){var n=i?t:e;return n.shift()||new rl.gui.DatePicker({showTime:i}).render()},push:function(i){var n=i&&i.timeSelect?t:e;n.push(i)},toString:function(){return"[object rl.gui.DatePicker.Pool]"}}}(),rl.gui.DatePicker.tips=(rl.getG11nSource("rl.gui.DatePicker")||{}).tips||{}});