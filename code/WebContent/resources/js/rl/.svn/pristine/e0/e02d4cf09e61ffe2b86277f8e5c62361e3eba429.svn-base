/**
 * @fileOverview Layout engine.
 * @change
 	#1 by prcjack @2014/05/29 Creates file.
 */
orderjs.define("gui.layout.engine",["gui.engine","css>rl:layout"],function(){!function(){rl.createNamespace("rl.gui.layout"),rl.gui.layout.ComponentWrap=rl.createClass({parent:rl.util.EventProvider,construct:function(t){if(!rl.isPrototyping(arguments[0])){rl.gui.layout.ComponentWrap.parent.call(this,t),rl.ext(this,t);var i=document.createElement("div");this.dw=new rl.DomWrap(i),this.initMargin(),t&&(rl.isNonNullStr(t.cls)&&this.dw.addClass(t.cls),rl.isElement(t.container)&&t.container.appendChild(i),this.setViewRegionWidth(t.iniViewRegionWidth),this.setViewRegionHeight(t.iniViewRegionHeight)),i=void 0}},members:{cls:"",minHeight:10,maxHeight:2e3,minWidth:10,maxWidth:2e3,margin:null,iniViewRegionWidth:0,iniViewRegionHeight:0,marginRe:/\w+\b/g,_createSplit:function(t){this.splitBar||(this.splitBar=new rl.gui.LayoutSplitBar(t.orientation),this.splitBar.dw.addClass("rl_layout_split"),rl.isElement(t.container)&&t.container.appendChild(this.splitBar.ele))},initMargin:function(){var t=this.margin;if(rl.isString(t)&&t.trim(),rl.isObject(t)||(this.margin={}),rl.isNonNullStr(t)){var i=t.match(this.marginRe);if(rl.isArray(i)){var e=i.length,n=this.margin;1==e?n.top=n.right=n.bottom=n.left=parseInt(i[0]):2==e?(n.top=n.bottom=parseInt(i[0]),n.right=n.left=parseInt(i[1])):4==e&&(n.top=parseInt(i[0]),n.right=parseInt(i[1]),n.bottom=parseInt(i[2]),n.left=parseInt(i[3]))}}},setComponent:function(t){if(t instanceof rl.gui.ComponentBase){var i=this._component=t,e=this.dw.getDom();i.appendDomTo(e),this.updateComponentSize()}},getComponent:function(){return this._component},setViewRegionWidth:function(t){if(!isNaN(t)){t<this.minWidth&&(t=this.minWidth),t>this.maxWidth&&(t=this.maxWidth);var i=this.margin,e=parseInt(i.left)||0,n=parseInt(i.right)||0;this._viewRegionWidth=t,this.setWidth(t-e-n)}},setViewRegionHeight:function(t){if(!isNaN(t)){t<this.minHeight&&(t=this.minHeight),t>this.maxHeight&&(t=this.maxHeight);var i=this.margin,e=parseInt(i.top)||0,n=parseInt(i.bottom)||0;this._viewRegionHeight=t,this.setHeight(t-e-n)}},setViewRegionTop:function(t){if(!isNaN(t)&&this._viewRegionTop!=t){var i=this.margin,e=parseInt(i.top)||0;this._viewRegionTop=t,this.top=t+e,this.dw.setTop(this.top)}},setViewRegionLeft:function(t){if(!isNaN(t)&&this._viewRegionLeft!=t){var i=this.margin,e=parseInt(i.left)||0;this._viewRegionLeft=t,this.left=t+e,this.dw.setLeft(this.left)}},getViewRegion:function(){var t;return t=this.hidden?{left:0,top:0,width:0,height:0}:{left:this._viewRegionLeft,top:this._viewRegionTop,width:this._viewRegionWidth,height:this._viewRegionHeight}},updateViewRegion:function(t){if(!t)return this;var i,e;for(e in t)i="setViewRegion"+e.capitalize(),rl.isFunction(this[i])&&this[i](t[e]);return this},updateComponentSize:function(){var t=this._component;this._setComponentWidth(this.width||t.getWidth()),this._setComponentHeight(this.height||t.getHeight())},setHeight:function(t){return t=parseInt(t),t==this.height?this:(this.height=t,this.dw.setHeight(t),this._setComponentHeight(t),this)},setWidth:function(t){return t=parseInt(t),t==this.width?this:(this.width=t,this.dw.setWidth(t),this._setComponentWidth(t),this)},_setComponentWidth:function(t){var i=this._component;if(i&&i.setWidth&&i.dw){var e=rl.dom.sumBoxBnP(i.dw.dom);isNaN(e)&&(e=0),i.setWidth(t-e)}},_setComponentHeight:function(t){var i=this._component;if(i&&i.setHeight&&i.dw){var e=rl.dom.sumBoxBnP(i.dw.dom,!0);isNaN(e)&&(e=0),i.setHeight(t-e)}},show:function(){return this.hidden&&(this.dw.removeClass("rl_layout_hidden"),this.hidden=!1),this},hide:function(){return this.hidden||(this.dw.addClass("rl_layout_hidden"),this.hidden=!0),this},toString:function(){return"[object rl.gui.layout.ComponentWrap]"}}})}(),function(){rl.createNamespace("rl.gui.layout"),rl.gui.layout.LayoutBase=rl.createClass({parent:rl.util.EventProvider,construct:function(t){rl.isPrototyping(arguments[0])||(rl.gui.layout.LayoutBase.parent.call(this,t),rl.ext(this,t))},members:{initContainer:function(t){if(!this._containerInited&&rl.gui.ComponentBase&&t instanceof rl.gui.ComponentBase){this.container=t;var i=this.container.dw,e=i.getDom(),n=document.body,o=this._config;if(e!=n||o.allowScroll)e!=n&&"static"==i.getStyle("position")&&(e.style.position="relative");else{var r={height:"100%"};rl.IE&&rl.VER_IE<8&&(r.overflow="hidden"),rl.$(n.parentNode).setStyle(r)}i.addClass("rl_layout_container"),this._containerInited=!0}},beginUpdate:function(){this.updating=!0},cancelUpdate:function(){this.updating=!1},endUpdate:function(){this.updating=!1,this.layoutContainer()},getViewRegionWidth:function(){return this.container.getWidth()},getViewRegionHeight:function(){return this.container.getHeight()},toString:function(){return"[object rl.gui.layout.LayoutBase]"}}})}(),function(){rl.gui.layout.FlowLayout=rl.createClass({parent:rl.gui.layout.LayoutBase,construct:function(t){rl.isPrototyping(arguments[0])||rl.gui.layout.FlowLayout.parent.call(this,t)},members:{align:"left",hgap:0,vgap:0,onOverflow:rl.EMPTY_FUNCTION,setAlignment:function(){},initContainer:function(t){this.container=t},addLayoutComponent:function(t){var i=this.container;rl.debug("c = "+i),i.dw.getDom().appendChild(t.dw.getDom())},setWrapAnchor:function(t,i){var e=rl.gui.layout.ComponentWrap;if(t&&e&&t instanceof e&&rl.isNonNullStr(i)){i.trim().split(" ")}},toString:function(){return"[object rl.gui.layout.FlowLayout]"}}})}(),function(){rl.gui.layout.BorderLayout=rl.createClass({parent:rl.gui.layout.LayoutBase,construct:function(t){rl.isPrototyping(arguments[0])||(rl.gui.layout.BorderLayout.parent.call(this),this._components={},this._wraps={},this.setConfig(t))},members:{_addWrap:function(t,i){var e,n;e=n=i.iniSize,"north"==t||"south"==t?(e=this.getViewRegionWidth(),i.maxSize&&(i.maxHeight=i.maxSize),i.minSize&&(i.minHeight=i.minSize)):(n=this._config._iniCenterHeight,"center"==t?e=this._config._iniCenterWidth:(i.maxSize&&(i.maxWidth=i.maxSize),i.minSize&&(i.minWidth=i.minSize))),this._wraps[t]=new rl.gui.layout.ComponentWrap(rl.ext({container:this.container.dw.getDom(),cls:"rl_layout_"+t.toLowerCase(),iniViewRegionWidth:e,iniViewRegionHeight:n,margin:i.margin,showSplit:i.showSplit},i))},initContainer:function(t,i){if(rl.gui.layout.BorderLayout.parent.prototype.initContainer.call(this,t,i),this._containerInited){var e=this._config;this.initCenterSize(e),e.center||(e.center={}),Array.each(function(t){e[t]&&this._addWrap(t,e[t])},rl.gui.layout.BorderLayout.CONSTRAINTS,this),i&&this.addConfigComps()}},initCenterSize:function(t){t._iniCenterHeight=this.getViewRegionHeight(),t._iniCenterWidth=this.getViewRegionWidth(),t.north&&(t._iniCenterHeight-=t.north.iniSize||0),t.south&&(t._iniCenterHeight-=t.south.iniSize||0),t.west&&(t._iniCenterWidth-=t.west.iniSize||0),t.east&&(t._iniCenterWidth-=t.east.iniSize||0)},addConfigComps:function(){var t=this._config,i=this.container,e=function(e){t[e]&&t[e].comp&&i.add(t[e].comp,e)};i&&(i.beginLayout(),Array.each(e,rl.gui.layout.BorderLayout.CONSTRAINTS),i.endLayout())},setConfig:function(t){this._config=t},_isValidConstraint:function(t){return rl.gui.layout.BorderLayout.CONSTRAINTS.contains(t)},addLayoutComponent:function(t,i){if(rl.isNonNullStr(i)||(i="center"),i=i.toLowerCase(),!this._isValidConstraint(i))throw new Error(this+" -> addLayoutComponent(): Invalid constraint: "+i);var e=this._wraps[i];if(!e)throw new Error(this+" -> addLayoutComponent(): Constraint: "+i+" not configed!");e.setComponent(t),this._components[i]=t},removeLayoutComponent:function(){},getLayoutComponent:function(t){return t=t.toLowerCase(),this._isValidConstraint(t)?this._components[t]:null},toggleLayoutComponent:function(t){var i=this.getWrap(t);return i?(i.hidden?i.show():i.hide(),i):void 0},hideLayoutComponent:function(t){var i=this.getWrap(t);return i&&!i.hidden?(i.hide(),this.layoutContainer(),i):void 0},showLayoutComponent:function(t){var i=this.getWrap(t);return i&&i.hidden?(i.show(),this.layoutContainer(),i):void 0},getLayoutComponentConstraint:function(t){var i;return rl.each(this._components,function(e,n){return e==t?(i=n,!1):void 0}),i},getWrap:function(t){return t=t instanceof rl.gui.ComponentBase?this.getLayoutComponentConstraint(t):t.toLowerCase(),this._isValidConstraint(t)?this._wraps[t]:null},layoutContainer:function(){if(!this.updating){var t=this.getViewRegionWidth(),i=this.getViewRegionHeight(),e=t,n=i,o=0,r=0,s=this._wraps,a=s.north,h=s.east,u=s.south,g=s.west,l=s.center;if(a&&!a.hidden){var d=a.getViewRegion(),c=d.height;d.width=t,a.updateViewRegion(d),c=a.getViewRegion().height,o+=c,n-=c}if(u&&!u.hidden){var d=u.getViewRegion(),c=d.height;d.top=i-c,d.width=t,u.updateViewRegion(d),c=u.getViewRegion().height,n-=c}if(g&&!g.hidden){var d=g.getViewRegion(),p=d.width;d.top=o,d.height=n,g.updateViewRegion(d),p=g.getViewRegion().width,r+=p,e-=p}if(h&&!h.hidden){var d=h.getViewRegion(),p=d.width;d.top=o,d.left=t-p,d.height=n,h.updateViewRegion(d),p=h.getViewRegion().width,e-=p}l&&l.updateViewRegion({top:o,left:r,width:e,height:n}),this.fireEvent("layout",o,r,e,n)}},toString:function(){return"[object rl.gui.layout.BorderLayout]"}}}),rl.gui.layout.BorderLayout.CONSTRAINTS=["north","south","east","west","center"]}()});