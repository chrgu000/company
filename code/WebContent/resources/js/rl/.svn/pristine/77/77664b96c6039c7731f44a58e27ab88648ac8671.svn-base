/**
 * @fileOverview DateSelect control.
 * @change
 	#1 by prcjack Creates file.
 */
orderjs.define("gui.form.DateSelect",["lib.data.Calendar","gui.engine","gui.button.IconButton","gui.form.Input","gui.DatePicker","css>rl:inputs"],function(){rl.gui.form.DateSelect=rl.createClass({parent:rl.gui.form.Input,construct:function(t){rl.isPrototyping(arguments[0])||rl.gui.form.DateSelect.parent.call(this,t)},members:{format:"%Y-%m-%d %H:%M",showTime:!1,iniShowClearer:!1,iniVisible:!0,autoShowClearer:!0,editable:!1,popup:null,_extraCtrlsWidth:30,_interactiveStateCssPrefix:"rl_ctm_input_",_interactiveMouseTypes:["out","over"],_htmlTpl:new rl.HtmlTpl('<span id="{id}" class="rl_comp rl_input rl_ctm_input rl_dateselect {css}" title="{tip}"><label for="{ctrlId}" class="{labelCss}">{label}</label><span class="wrapper" id="{wrapperId}"><input id="{ctrlId}" value="{value}" name="{name}" class="{ctrlCss}" {disabledState} {readonlyState} /><img class="clearer" style="border:none; visibility: hidden;" id="{clearerId}" src="'+rl.gui.URL_BLANK_IMG+'" /><span id="{popupCtrlId}"></span></span></span>'),initialize:function(){this.dw=new rl.dom.DomWrap,rl.isNonNullStr(this.id)||(this.id=this.autoId());var t=this.id;this.ctrlId=t+"_ctrl",this.wrapperId=t+"_wrapper",this.clearerId=t+"_clearer",this.popupCtrlId=t+"_popupCtrl",this.showTime||(this.format=this.format.split(" ")[0]),this.initDataSource(),rl.gui.compStore.add(this.id,this),this.autoRenderOnReady&&rl.onReady(Function.bind(this.render,this))},initDataSource:function(){var t=this.dataSource;t||(t=this.dataSource=new rl.data.Calendar({defaultFormat:this.format,iniDate:Date.parseDate(this.value,this.format)})),t.on("change",this.hndDataChange,this)},initView:function(){this.initCtrl(),rl.dom.STEADY_INLINE_HEIGHT||rl.$(this.wrapperId).addClass("wrapper_inline_hack"),this.initEvents(),this.initExtraCtrls(),this.initSize(),this.iniVisible||this.hide(),this.updateValueListener()},initEvents:function(){var t,i,e=this.dw;rl.IE?(t="focusin",i="focusout"):(t="focus",i="blur"),e.on(t,this.hndFocus,this,!0),e.on(i,this.hndBlur,this,!0),e.on("mouseover",this.hndMouseover,this),e.on("mouseout",this.hndMouseout,this),e.on("mousedown",this.hndMousedown,this),e.on("click",this.hndClick,this)},initCtrl:function(){var t=rl.$(this.ctrlId);this._ctrlEle=t.dom,t.on("change",this.hndCtrlEleChange,this)},initExtraCtrls:function(){this.autoShowClearer&&this.initClearer(),this.initPopupCtrl(),this.initPopup()},initClearer:function(){var t=rl.$(this.clearerId);t.on("mouseover",this.hndClearerMouseover,this),t.on("mouseout",this.hndClearerMouseout,this),t.on("mousedown",this.hndClearerMousedown,this),this.on("change",this.checkClearerDisplay,this),this.iniShowClearer&&this.checkClearerDisplay()},initPopupCtrl:function(){this.popupCtrl=new rl.gui.button.IconButton({_sizeCss:"actionctrl",renderTarget:this.popupCtrlId,icon:rl.gui.mapImg("inputs/calendar.gif"),disabledIcon:rl.gui.mapImg("inputs/calendar_disabled.gif"),action:Function.bind(this.showPopup,this)})},initPopup:function(){this.popup=new rl.gui.PopupWrap({owner:this}),this.popup.on("hide",this.hndPopupHide,this)},initSize:function(){var t=this.width;delete this.width,this.width=void 0,this.setWidth(t)},render:function(t){if(this._rendered)return this;t=this.getRenderTarget(t);var i,e=this.disabled?" disabled='disabled' ":"",s=this.editable?"":" readonly='readonly' ";return i=this._htmlTpl.renderTo(t,{css:this.css+(this.alignRight?" rl_alignright":""),labelCss:this.labelCss,ctrlCss:this.ctrlCss,id:this.id,ctrlId:this.ctrlId,wrapperId:this.wrapperId,clearerId:this.clearerId,popupCtrlId:this.popupCtrlId,label:this.label,tip:this.tip,name:this.name,value:this.value,disabledState:e,readonlyState:s},this.renderPosition),this.dw.setTarget(i),i=null,this.initView(),this._rendered=!0,this.fireEvent("render"),this},blur:function(){this._ctrlEle&&this._ctrlEle.blur()},disable:function(){return this.disabled?this:(this.disabled=!0,this._ctrlEle&&(this._ctrlEle.disabled=!0),this.displayStateChangedStyle(),rl.isNonNullStr(this.disabledIcon)&&this._updateIconView(this.disabledIcon),this.popupCtrl.disable(),this)},enable:function(){return this.disabled?(this.disabled=!1,this._ctrlEle&&(this._ctrlEle.disabled=!1),this.displayStateChangedStyle(),rl.isNonNullStr(this.disabledIcon)&&this._updateIconView(this.getIcon()),this.popupCtrl.enable(),this):this},focus:function(){this._ctrlEle&&this._ctrlEle.focus()},setWidth:function(t){var i=this.width;if(t===i)return this;rl.debug(this+" value = "+t);var e=this.dw.dom;if(rl.isElement(e)){var s=t;if(rl.isNumber(s)||(/%/.test(s)?s=rl.$(e.parentNode).getWidth():/auto/.test(s)||(s=parseInt(s))),rl.isNumber(s)){var r=s-this._extraCtrlsWidth;rl.$(this.ctrlId).setWidth(r)}}return this.width=t,this.fireEvent("widthchange",t,i),this},setFormat:function(t){var i=this.format;return i===t?this:(this.format=t,this._updateFromData(),this)},clear:function(){return this.setValue(""),this},showClearer:function(){rl.$(this.clearerId).setStyle("visibility: inherit;")},hideClearer:function(){rl.$(this.clearerId).setStyle("visibility: hidden;")},checkClearerDisplay:function(){var t=String(this.value);0==t.length?this.hideClearer():this.showClearer()},showPopup:function(){if(this.popup.hidden){var t=this.popup,i=rl.gui.DatePicker.Pool.pull(this.showTime);t.setTarget(i),i.dataSource.setDateTime(this.dataSource.getTime()),i.dataSource.on("change",this.hndDatePickerDataChange,this),i.on("select",this.hndDatePickerSelect,this),t.show()}},hidePopup:function(){this.popup.hide(),this.fireEvent("popuphide")},deferShowPopup:function(){Function.defer(this.showPopup,this)},hndPopupHide:function(){var t=this.popup,i=t.target;i.un("select",this.hndDatePickerSelect,this),i.dataSource.un("change",this.hndDatePickerDataChange,this),rl.gui.DatePicker.Pool.push(i),t.removeTarget()},hndDatePickerSelect:function(){this._updateFromData(),this.hidePopup(),this.fireEvent("select")},hndDatePickerDataChange:function(){this.dataSource.setTime(this.popup.target.dataSource.getTime())},hndDataChange:function(){this._updateFromData()},hndFocus:function(){this.disabled||(this.focused=!0,this.applyInteractiveStyle("out"),this.deferShowPopup())},hndBlur:function(){this.disabled||(this.focused=!1,this.applyInteractiveStyle("out"))},hndMouseover:function(){this.disabled||this.applyInteractiveStyle("over")},hndMouseout:function(){this.disabled||this.applyInteractiveStyle("out")},hndMousedown:function(t){var i=rl.ew.init(t),e=i.getTarget();e.id==this.wrapperId&&this.focus()},hndClick:function(){},hndClearerMouseover:function(){rl.$(this.clearerId).addClass("clearer_bg_over")},hndClearerMouseout:function(){rl.$(this.clearerId).removeClass("clearer_bg_over")},hndClearerMousedown:function(){this.clear()},_updateFromData:function(){var t=this.dataSource.format(this.format);this._ctrlEle.value=t,this.setValue(t)},_getInteractiveStateCss:function(t){if(rl.isNonNullStr(t)&&(t=t.toLowerCase(),this._interactiveMouseTypes.contains(t))){var i=this._interactiveStateCssPrefix;return this.disabled?i+="disabled":this.focused?i+="focused":"out"==t?i="":i+=t,i}},toString:function(){return"[object rl.gui.form.DateSelect]"}}}),rl.gui.ctype2Classes.add("DateSelect",rl.gui.form.DateSelect)});