orderjs.define("gui.tree.FastTree",["lib.dom.engine","lib.dom.DomWrap","gui.engine","css>rl:fasttree"],function(){function t(t,i,s,n,r,o,a,l){this.id=t,this.pid=i,this.value=s,n&&(this.src1=e.mapping(n)),this.actionData=o,this.target=a?a:null,this.isClose=l?l:!1}var i=rl.pm.setRoot(rl.gui.imgPM.mapping("tree/fasttree/")),e=new rl.util.PathMapping,s=i.mapping("folderopen.gif"),n=i.mapping("folderclose.gif"),r=i.mapping("leaf.gif");rl.gui.FastTree=rl.createClass({parent:rl.gui.ContainerBase,construct:function(t){rl.isPrototyping(arguments[0])||(rl.gui.FastTree.parent.call(this,t),this.icons={plus:i.mapping("nolines_plus.gif"),minus:i.mapping("nolines_minus.gif"),empty:i.mapping("empty.gif"),joinLine:i.mapping("join.gif"),joinBottom:i.mapping("joinbottom.gif"),line:i.mapping("line.gif"),plusLine:i.mapping("plus.gif"),minusLine:i.mapping("minus.gif"),plusBottom:i.mapping("plusbottom.gif"),minusBottom:i.mapping("minusbottom.gif")},this.list={},this.treeMap={},this.totalNodes=0,rl.ext(this,t),this.dw=new rl.DomWrap,rl.isNonNullStr(this.id)||(this.id=rl.autoId()),this.autoRenderOnReady&&rl.onReady(Function.bind(this.render,this)))},members:{treeStr:"",totalNodes:0,iniOpenTo:"",autoRenderOnReady:!0,deferRenderNodes:!0,autoExpandRoot:!0,width:"100%",height:"100%",lazyRender:!0,render:function(t){return this.loadNodeData(this.dataNode),this._rendered?this:(t=this.getRenderTarget(t),this.treeStr="<div class='rl_fasttree' id='"+this.id+"' width='"+this.width+"' height='"+this.height+"' >",this.toTreeMap(),this.makeTreeHasLine(0,""),this.treeStr+="</div>",t.innerHTML=this.treeStr,this.dw.setTarget(t.firstChild),Function.defer(this.initFirstOpenTo,this),this._rendered=!0,this.fireEvent("render"),this)},loadNodeData:function(t){this.nodeDataLoaded||(e.setRoot(t.getAttribute("iconRoot")),this.iniOpenTo=t.getAttribute("iniOpenTo"),rl.dom.cleanWhitespace(t),this.addFromNode(t.firstChild),this.nodeDataLoaded=!0)},addFromNode:function(t,i){if(rl.isElement(t)){{var e,s,n=t.getAttribute("id");rl.gui.FastTree.iconRootPm}n||(n=rl.autoId(),t.setAttribute("id",n)),i||(i=0),this.add(n,i,t.getAttribute("text"),t.getAttribute("icon"),null,t.getAttribute("actionData"),null,!1),s=t.childNodes;for(var r=0,o=s.length;o>r;r++)e=s[r],rl.isElement(t)&&this.addFromNode(e,n);this.totalNodes++}},add:function(i,e,s,n,r,o,a){this.list[i]=new t(i,e,s,n,r,o,a)},toTreeMap:function(){var t;for(var i in this.list)if(t=this.list[i],!rl.isFunction(t)){var e=this.list[i].id,s=this.list[i].pid;null==this.treeMap[s]&&(this.treeMap[s]={}),this.treeMap[s][e]=this.list[i]}},makeTreeHasLine:function(t,i){var e=1,o=this.sonSize(this.treeMap[t]);for(var a in this.treeMap[t])if(1!=this.lazyRender||"marginLeft"!=a){var l=!1,d=this.lazyRender&&0!=t?e==o-1:e==o;null!=this.treeMap[a]&&(l=!0);var h=this.treeMap[t][a],c="tDiv"+a,u="tImg"+a,p="tImgT"+a,m=i,g=d?this.icons.minusBottom:this.icons.minusLine,f=d?this.icons.joinBottom:this.icons.joinLine,v=l?"<img src='"+g+"' id='"+u+"' onclick='"+this.obj+".alterTree(&quot;"+a+"&quot;)' class='croImg'/>":"<img src='"+f+"'/>";h.src1||(h.src1=l?n:r,h.src2=l?s:r);var y=h.src1;!l||this.lazyRender||h.isClose||(y=h.src2);var T="<img id='"+p+"' src='"+y+"' style='height:16px;width:16px'  onclick='"+this.obj+".alterTree(&quot;"+a+"&quot;)' />",N="<span class='treeTitle'> <a href='###' onclick='"+this.obj+".alterTree(&quot;"+a+"&quot;); "+this.obj+".doAction(&quot;"+a+"&quot;); "+this.obj+".activate(this);' >"+h.value+"</a></span>",b=m+v+T+N+"<br>"+(l?"<div id='"+c+"' style='display:block'>":"");if(l&&(this.lazyRender||h.isClose)&&(b=b.replace("block","none"),b=b.replace("minus","plus")),this.treeStr+=b,l){var M=d?this.icons.empty:this.icons.line;m+="<img src='"+M+"'/>",this.lazyRender?this.treeMap[a].marginLeft=m:this.makeTreeHasLine(a,m),this.treeStr+="</div>"}e++}},sonSize:function(t){var i=0;for(var e in t)i++;return i},alterTree:function(t){var i=document.getElementById("tDiv"+t);i&&("block"==i.style.display?this.closeNode(t):this.openNode(t))},activate:function(t){this.lastActivated&&rl.$(this.lastActivated).removeClass("bgGray"),this.lastActivated=t,rl.$(this.lastActivated).addClass("bgGray")},doAction:function(t){var i=this.list[t];if(i){var e=i.actionData;rl.isNonNullStr(e)&&this.action(e)}},openNode:function(t){var i=document.getElementById("tDiv"+t),e=document.getElementById("tImg"+t),s=document.getElementById("tImgT"+t);if(i){if(i.style.display="block",e.src=e.src.replace("plus","minus"),null!=this.treeMap[t]){var n=this.list[t].src2;n&&(s.src=n)}1==this.lazyRender&&""==i.innerHTML&&(this.treeStr="",this.makeTreeHasLine(t,this.treeMap[t].marginLeft),i.innerHTML+=this.treeStr,this.alterbg)}},closeNode:function(t){var i=document.getElementById("tDiv"+t),e=document.getElementById("tImg"+t),s=document.getElementById("tImgT"+t);i.style.display="none",e.src=e.src.replace("minus","plus"),s.src=this.list[t].src1},openAll:function(){for(var t in this.treeMap)0==t||rl.isFunction(this.treeMap[t])||t&&this.openNode(t)},closeAll:function(){for(var t in this.treeMap)if(0!=t){if(1==this.lazyRender){var i=document.getElementById("tDiv"+t);if(null==i)continue}this.closeNode(t)}},findNode:function(i){var e;return i instanceof t&&(i=i.id),rl.isNonNullStr(i)&&(e=this.list[i]),e},openTo:function(t){if(t=this.findNode(t)){for(var i,e=this.list,s=[];t&&t.id;)i=t.id,s.push(i),t=e[t.pid];for(;i=s.pop();)this.openNode(i)}},initFirstOpenTo:function(){var t,i=this.iniOpenTo;if(rl.isNonNullStr(i)&&(t=this.findNode(i)),t)this.openTo(t);else if(this.autoExpandRoot){var e=this.treeMap[0];for(var s in e)s&&this.openNode(s)}},toString:function(){return"[object rl.gui.FastTree]"}}})});