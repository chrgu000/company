orderjs.define("gui.list.List",["lib.data.Table","gui.engine","gui.list.ListItem","css>rl:list"],function(){rl.gui.list.List=rl.createClass({parent:rl.gui.ContainerBase,construct:function(t){rl.isPrototyping(arguments[0])||(rl.gui.list.List.parent.call(this,t),this.initialize())},members:{multiple:!1,width:"",height:"",maxHeight:150,maxWidth:100,dataSource:null,itemType:rl.gui.list.ListItem,trackMouseover:!0,showAllSelector:!0,allSelectorPosition:"top",allSelectorText:"全选",_htmlTpl:new rl.HtmlTpl('<div class="rl_input rl_list" id="{id}" {widthAttr} {heightAttr}>{topAllSelectorHtml}<div class="rl_items_scroll_ctrl"><ul class="rl_items_ctn" id="{itemsCtnId}">{itemsHtml}</ul></div>{bottomAllSelectorHtml}</div>'),_allSelectorHtmlTpl:new rl.HtmlTpl('<ul class="rl_all_selector"><li><input id="{id}" class="rl_li_selector" type="checkbox" /><span class="rl_li_text"><label for="{id}">{text}</label></span></li></ul>'),initialize:function(){this.dw=new rl.DomWrap,this._domId=this.autoId(),this._ctrlId=this._domId+"_ctrl",this._itemsCtnId=this._domId+"_itemsCtn",this.multiple&&(this._allSelectorId=this._domId+"_allSelector"),rl.gui.compStore.add(this.id,this),this.items=rl.isArray(this.items)?this.initConfigItems(this.items):[],this._namedItemsStore={},this._selectedItems=[]},render:function(t){if(this._rendered)return this;t=this.getRenderTarget(t);var e=this._htmlTpl.renderTo(t,this._getRenderValues(),this.renderPosition);return this.dw.setTarget(e),this.initEvents(),rl.gui.makeUnselectable(e),this.items.length>0&&this.afterRenderItems(),this._rendered=!0,this.fireEvent("render"),this},loadItems:function(){var t=this.dataSource;if(t&&t.rows&&t.rows.length>0){var e=this.items;return t.each(function(t){e.push(this._createItem(t.getAll()))},this),this.renderItems(),this}},clearItems:function(){var t=this.items,e=t.length;return e>0?(this.each(this._afterRemove),this.items=[],this._namedItemsStore={},this._selectedItems=[],this._lastMouseoverItem=null,this.checkAllSelectedState(),rl.getDom(this._itemsCtnId).innerHTML="",this):this},renderItems:function(){var t=this.items,e=t.length;return e>0?(rl.getDom(this._itemsCtnId).innerHTML=this.getItemsRenderHtml(),this.afterRenderItems(),this):this},getItemsRenderHtml:function(){var t=Array.map(function(t){return t.getRenderHtml()},this.items);return t.join("")},setWidth:function(t){var e=this.width;return t=rl.dom.addUnit(t),e==t?this:(this.width=t,this.dw.setWidth(t),this._updateItemsScrollCtnWidth(),this.fireEvent("widthchange",t,e),this)},setHeight:function(t){var e=this.height;return t=rl.dom.addUnit(t),e==t?this:(this.height=t,this.dw.setHeight(t),this._updateItemsScrollCtnHeight(),this.fireEvent("heightchange",t,e),this)},getWidth:function(){var t=this.width;if(!t||"auto".equalsIgnoreCase(t)){var e=this.dw.dom;e&&(t=e.offsetWidth)}else t=parseInt(t);return t},getHeight:function(){var t=this.height;if(!t||"auto".equalsIgnoreCase(t)){var e=this.dw.dom;e&&(t=e.offsetHeight)}else t=parseInt(t);return t},initConfigItems:function(t){for(var e,i=t.length-1;i>-1;i--)e=t[i],e?t[i]=this._createItem(e):t.removeAt(i);return t},_createItem:function(t){if(t instanceof rl.gui.ComponentBase)return t;var e,i;return i=rl.isObject(t)?this.getItemType(t.ctype):this.itemType,e=new i(rl.fill(this._getCIExtra(t),t))},_getCIExtra:function(){return{owner:this,hasSelector:this.multiple}},_getRenderValues:function(){var t={},e=rl.dom.addUnit,i=this.width,s=this.height,l=i&&"auto"!=i?"width='"+e(i)+"' ":"",r=s&&"auto"!=s?"height='"+e(s)+"' ":"",h=this.items,n=h.length>0?this.getItemsRenderHtml():"";if(this.multiple&&this.showAllSelector){var o=this._allSelectorHtmlTpl.assign({id:this._allSelectorId,text:this.allSelectorText});t[this.allSelectorPosition.toLowerCase()]=o}return{id:this._domId,itemsCtnId:this._itemsCtnId,widthAttr:l,heightAttr:r,itemsHtml:n,topAllSelectorHtml:t.top||"",bottomAllSelectorHtml:t.bottom||""}},_afterRemove:function(t){rl.isFunction(t.unSelect)&&t.unSelect(),delete t.owner,t.removeDom(),this.afterRowChange(t)},afterRenderItems:function(){if(Array.each(function(t){t.afterRenderByOwner()},this.items),this._isAutoHeight())this._doAutoHeight();else{var t=this.height;this.height=-1,this.setHeight(t)}},initEvents:function(){var t=this.dw;t.on("mousewheel",this.hndMousewheel,this),t.on("mouseover",this.hndMouseover,this),t.on("mouseout",this.hndMouseout,this),t.on("click",this.hndClick,this);var e=rl.getDom(this._allSelectorId);e&&rl.$(e).on("click",this.hndAllSelectorChange,this)},hndMousewheel:function(t){var e=rl.getDom(this._itemsCtnId).parentNode;if(e){var i=rl.ew.init(t),s=i.wheelDelta(),l=this._calItemHeight()||20;e.scrollTop+=l*(s>0?-1:1),i.stopDefault()}},_calItemHeight:function(){if(!this._itemHeight){var t=this.items.length,e=rl.getDom(this._itemsCtnId);e&&t>0&&(this._itemHeight=e.offsetHeight/t)}return this._itemHeight},_calItemsOuterWidth:function(){return 0},_calItemsOuterHeight:function(){if(!rl.isDefined(this._itemsOuterHeight))if(this.multiple&&this.showAllSelector){var t=rl.getDom(this._allSelectorId);t&&(t=t.parentNode.parentNode,this._itemsOuterHeight=t.offsetHeight+rl.dom.sumBoxBnP(t,!0),rl.debug(this+" ele.tagName = "+t.tagName+" ele.offsetHeight = "+t.offsetHeight+" ele.scrollHeight= "+t.scrollHeight),rl.debug(this+" this._itemsOuterHeight = "+this._itemsOuterHeight))}else this._itemsOuterHeight=0;return this._itemsOuterHeight||0},_updateItemsScrollCtnWidth:function(){var t=this.dw.dom.offsetWidth,e=t-this._calItemsOuterWidth(),i=rl.getDom(this._itemsCtnId),s=i.parentNode;rl.$(s).setWidth(e),this._itemsOverflowY&&(e-=18),rl.$(i).setWidth(e)},_updateItemsScrollCtnHeight:function(){var t=this.dw.dom.offsetHeight,e=t-this._calItemsOuterHeight(),i=rl.getDom(this._itemsCtnId),s=i.parentNode;rl.debug(this+" H = "+t+" h = "+e),rl.$(s).setHeight(e),this._itemsOverflowX&&(e-=18),rl.$(i).setHeight(e)},_updateItemsOverflowStates:function(){var t=rl.getDom(this._itemsCtnId);if(t){var e=t.parentNode;this._itemsOverflowX=t.offsetWidth>e.offsetWidth,this._itemsOverflowY=t.offsetHeight>e.offsetHeight}},_doAutoHeight:function(){if(this.dw.dom){var t=this.dw.dom.offsetHeight,e=this.maxHeight,i=t>e?e:"auto";this.dw.setHeight(i),this._updateItemsScrollCtnHeight()}},_isAutoHeight:function(){var t=this.height;return rl.isEmpty(t)||"auto".equalsIgnoreCase(t)},hndMouseover:function(t){if(this.trackMouseover){var e=this.getItemByEvent(t);e&&(this._lastMouseoverItem&&this._lastMouseoverItem.applyInteractiveStyle("out"),this._lastMouseoverItem=e,e.applyInteractiveStyle("over"))}},hndMouseout:function(t){if(this._lastMouseoverItem){var e=rl.ew.init(t).getRelatedTarget();rl.$(this._itemsCtnId).within(e)||this._lastMouseoverItem.applyInteractiveStyle("out")}},hndClick:function(t){var e=this.getItemByEvent(t);if(e)if(this._lastFocusedItem&&this._lastFocusedItem.blur(),this._lastFocusedItem=e,e.focus(),this.multiple){var i=rl.ew.init(t).getTarget();e.isSelectorEle(i)?i.checked?this.selectItem(e):this.unSelectItem(e):rl.ew.ctrlKey()?this.toggleSelectItem(e):this.selectSingle(e)}else this.selectItem(e)},hndAllSelectorChange:function(){var t=rl.getDom(this._allSelectorId);t&&(t.checked?this.selectAll():this.unSelectAll())},afterAllSelectStateChange:function(t){if(this.multiple){var e=rl.getDom(this._allSelectorId);e&&(e.checked=t)}},afterItemSelectChange:function(t,e){if(this.multiple){var i=rl.gui.itf.iItemsSelectable.afterItemSelectChange;return i.apply(this,arguments)}var s=this._lastSelectedItem;e?(s&&s!=t&&s.unSelect(),this._lastSelectedItem=t):this._lastSelectedItem=null},_getItemsCtn:function(){return rl.getDom(this._itemsCtnId)},toString:function(){return"[object rl.gui.list.List]"}}}),rl.fill(rl.gui.list.List.prototype,rl.gui.itf.iItemsSelectable),rl.gui.ctype2Classes.add("List",rl.gui.list.List)});