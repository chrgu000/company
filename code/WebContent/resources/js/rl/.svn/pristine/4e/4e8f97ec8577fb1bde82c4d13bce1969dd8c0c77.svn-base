orderjs.define("gui.indicator.MsgPopup",["gui.engine","css>rl:msgpopup"],function(){rl.gui.indicator.MsgPopup=rl.createClass({parent:rl.gui.ComponentBase,construct:function(t){rl.isPrototyping(arguments[0])||(rl.gui.indicator.MsgPopup.parent.call(this,t),this.initialize())},members:{action:null,defaultIcon:"",showRecordNav:!0,showActionCtrl:!0,autoRenderOnReady:!0,titleFormat:"{title} - RealLight Framework",recordLabelFormat:"{current}/{total}",recordTipFormat:"共有{total}条新信息，当前显示第{current}条",actionCtrlText:"查看详细",actionCtrlTip:"查看详细信息",reBtnCloseCss:/btn_close/,reNavBtnCss_previous:/previous/,reNavBtnCss_next:/next/,reActionBtnCss:/btn_action/,popupCssModule:"msgpopup",width:304,height:118,popupVerticalMargin:28,popupHorizontalMargin:16,recordTotal:0,recordCurrent:-1,_htmlTpl:new rl.HtmlTpl('<table id="{id}" class="rl_comp rl_msg_popup" border="0" cellspacing="0" cellpadding="0"><tr><td class="head"><a href="###" class="hide_dashed_box">&nbsp;</href></td></tr><tr><td class="body" valign="top"><table class="title_bar" border="0" cellspacing="0" cellpadding="0"><tr><td><img class="icon" id="{iconId}"  src="'+rl.gui.URL_BLANK_IMG+'" /></td><td class="title_wrap"><div class="title" id="{titleCtnId}"></div></td><td><img title="关闭" class="btn_close" src="'+rl.gui.URL_BLANK_IMG+'" /></td></tr></table><div class="content" id="{contentCtnId}"></div></td></tr><tr><td class="foot">{actionCtrlHtml}{recordNavHtml}</td></tr></table>'),_actionCtrlHtmlTpl:new rl.HtmlTpl('<a href="###" class="btn_action" title="{tip}">{text}</a>'),_recordNavHtmlTpl:new rl.HtmlTpl('<div class="nav_bar"><img title="前一条" class="previous" src="'+rl.gui.URL_BLANK_IMG+'" /><span id="{recordLabelCtnId}"></span><img title="后一条" class="next" src="'+rl.gui.URL_BLANK_IMG+'" /></div>'),initialize:function(){rl.isNonNullStr(this.id)||(this.id=this.autoId());var t=this.id;this.iconId=t+"_icon",this.titleCtnId=t+"_titleCtn",this.contentCtnId=t+"_contentCtn",this.recordLabelCtnId=t+"_recordInfoCtn",this.msgList=[],rl.gui.compStore.add(this.id,this),this.autoRenderOnReady&&rl.onReady(Function.bind(this.render,this))},render:function(){if(this._rendered)return this;var t=window.createPopup(),i=t.document,e=i.body,n=i.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=this._getPopupCssSrc(),i.getElementsByTagName("head")[0].appendChild(n),e.style.margin=0,e.innerHTML=this._getPopupHtml(),rl.gui.makeUnselectable(e),this.popup=t,this.initViewCfg(),this.initEvents(),this._rendered=!0,this.fireEvent("render"),this},initViewCfg:function(){var t=screen.width,i=screen.height,e=this.popupHorizontalMargin,n=this.popupVerticalMargin;this.left=t-this.width-e,this.top=i-this.height-n},initEvents:function(){var t=this.popup.document.body;rl.$(t).on("mouseout",this.hndPopupMouseout,this).on("mouseover",this.hndPopupMouseover,this).on("click",this.hndPopupClick,this)},show:function(){var t=this.popup;return t&&(t.isOpen&&t.hide(),t.show(this.left,this.top,this.width,this.height)),this._startCheckHide(),this.fireEvent("show"),this},hide:function(){var t=this.popup;return t&&t.isOpen&&(t.hide(),this.fireEvent("hide")),this},_startCheckHide:function(){var t=this.popup;t&&t.isOpen&&(this._checkHideEventTimer=Function.interval(this._checkHideEvent,100,this))},_stopCheckHide:function(){window.clearInterval(this._checkHideEventTimer)},_checkHideEvent:function(){var t=this.popup;t&&!t.isOpen&&(this._stopCheckHide(),this.fireEvent("hide"))},add:function(t,i,e,n){var s=arguments[0];return rl.isNonNullStr(s)&&(s=rl.fill({title:t,content:i,icon:e,actionData:n},arguments[4])),this.msgList.push(s),this.recordTotal++,this.hndRecordTotalChange(),s},addBatch:function(t){Array.each(this._addBatchItem,t,this)},_addBatchItem:function(t){rl.isArray(t)||(t=[t]),this.add.apply(this,t)},showNewMsgs:function(t,i){i&&this.clear(),this.addBatch.apply(this,arguments),this.first(),this.show()},clear:function(){this.msgList.length=0,this.recordTotal=0,this.recordCurrent=-1,this.setIcon(this.defaultIcon),this.setTitle(""),this.setContent(""),this.updateRecordNav()},first:function(){return this.go(0)},last:function(){return this.go(this.recordTotal-1)},previous:function(){return this.go(this.recordCurrent-1)},next:function(){return this.go(this.recordCurrent+1)},go:function(t){var i=this.recordCurrent,e=this.recordTotal;return 1>e?this:(t=parseInt(t),t>e-1?t=e-1:(0>t||isNaN(t))&&(t=0),i==t?this:(this.recordCurrent=t,this.updateMsg(),this.updateRecordNav(),this.fireEvent("currentchange",t,e),this))},setIcon:function(t){var i=this.icon;if(i==t||!rl.isNonNullStr(t))return this;var e=this._getPopupEle(this.iconId);return e&&(e.style.backgroundImage="url("+t+")"),this.icon=t,this},setTitle:function(t){var i=this.title;if(i==t)return this;var e=this._getPopupEle(this.titleCtnId);return e&&(e.innerHTML=t),this.title=t,this},setContent:function(t){var i=this.content;if(i==t)return this;var e=this._getPopupEle(this.contentCtnId);return e&&(e.innerHTML=t),this.content=t,this},setRecordInfo:function(t,i){var e,n=this._getPopupEle(this.recordLabelCtnId);n&&(e={total:t,current:i+1},n.innerHTML=rl.format(this.recordLabelFormat,e),n.title=rl.format(this.recordTipFormat,e))},enableNavButton:function(t){return this._setNavButtonState(t,!0)},disableNavButton:function(t){return this._setNavButtonState(t,!1)},_setNavButtonState:function(t,i){var e,n,s=this._getPopupEle(this.recordLabelCtnId);s&&(n=s.parentNode,e=Array.find(function(i){return i.className.contains(t)?i:void 0},n.childNodes),e&&(e.className=i?t:t+"_disabled"))},updateMsg:function(){var t,i,e,n=this.msgList[this.recordCurrent];n&&(t=n.icon||this.defaultIcon,i=n.title,e=n.content,this.titleFormat&&(i=rl.format(this.titleFormat,{title:i})),this.setIcon(t),this.setTitle(i),this.setContent(e))},updateRecordNav:function(){var t=this.recordTotal,i=this.recordCurrent;try{t-1>i?this.enableNavButton("next"):this.disableNavButton("next"),i>0?this.enableNavButton("previous"):this.disableNavButton("previous"),this.setRecordInfo(t,i)}catch(e){rl.dir(e,this+" error")}return this},hndPopupMouseout:function(){this.hoverPopup=!1},hndPopupMouseover:function(){this.hoverPopup=!0},hndPopupClick:function(t){t=this.popup.document.parentWindow.event,rl.ew.init(t);var i,e=rl.ew.getTarget();e&&(i=e.className,this.reBtnCloseCss.test(i)?this.hide():this.reNavBtnCss_previous.test(i)?this.previous():this.reNavBtnCss_next.test(i)?this.next():this.reActionBtnCss.test(i)&&this.doAction())},doAction:function(){var t,i,e=this.action;rl.isFunction(e)&&(t=this.msgList[this.recordCurrent],i=t.actionData,e.call(this,i,t)),this.hide()},hndRecordTotalChange:function(){this.updateRecordNav()},hndRecordCurrentChange:function(){this.updateRecordNav()},_getPopupEle:function(t){try{return"string"==typeof t&&(t=this.popup.document.getElementById(t)),t}catch(i){return null}},_getPopupCssSrc:function(){return rl.ROOT_PATH+"res/css/"+this.popupCssModule+".css"},_getPopupHtml:function(){var t=this.showRecordNav?this._recordNavHtmlTpl.assign({recordLabelCtnId:this.recordLabelCtnId}):"",i=this.showActionCtrl?this._actionCtrlHtmlTpl.assign({text:this.actionCtrlText,tip:this.actionCtrlTip}):"";return this._htmlTpl.assign({id:this.id,iconId:this.iconId,titleCtnId:this.titleCtnId,contentCtnId:this.contentCtnId,actionCtrlHtml:i,recordNavHtml:t})},onDispose:function(){try{var t=this.popup.document.body;rl.$(t).un("mouseout",this.hndPopupMouseout,this).un("mouseover",this.hndPopupMouseover,this).un("click",this.hndPopupClick,this)}catch(i){}delete this.popup,delete this.action},toString:function(){return"[object rl.gui.indicator.MsgPopup]"}}}),rl.gui.ctype2Classes.add("MsgPopup",rl.gui.indicator.MsgPopup)});