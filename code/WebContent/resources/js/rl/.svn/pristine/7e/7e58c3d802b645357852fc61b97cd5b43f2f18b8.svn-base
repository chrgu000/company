orderjs.define("gui.indicator.TipMgr",["lib.rpc.engine","lib.rpc.SimpleStatusResponse","gui.engine","gui.indicator.ToolTip"],function(){rl.gui.indicator.TipMgr=rl.createClass({parent:rl.gui.ComponentBase,construct:function(t){rl.isPrototyping(arguments[0])||(rl.gui.indicator.TipMgr.parent.call(this,t),this.initialize())},members:{iniAreas:null,monitorType:rl.gui.indicator.ToolTip,requestMgrType:rl.rpc.SimpleStatusResponse,waitingContent:(rl.getG11nSource("rl.gui.indicator.TipMgr")||{}).waitingContent||"",failureContent:(rl.getG11nSource("rl.gui.indicator.TipMgr")||{}).failureContent||"",localTipAttrName:"rl-title",replacedTipAttrName:"rl-tip",remoteTipAttrName:"tip-url",tippedAttrName:"rl-tipped",requestOkStatus:"true",requestOkContentAttrName:"content",enableRemoteCache:!0,interceptTitles:!0,disabled:!1,areas:null,monitor:null,requestMgr:null,requestDelay:1e3,_remoteTipCache:null,initialize:function(){this.areas=[],this.enableRemoteCache&&(this._remoteTipCache={}),this.iniAreas&&Array.each(this.addArea,this.iniAreas,this),this.initMonitor(),this.initRequestMgr()},initMonitor:function(){this.monitor||(this.monitor=this.createMonitor());var t=this.monitor;t.on("hide",this.hndMonitorHide,this)},createMonitor:function(){return new this.monitorType({autoRenderOnReady:!0,useShadow:!0,cancelAutoHideOnmouseover:!0,autoHideOnmouseout:!1,autoHideDelay:400,autoShowDelay:500})},initRequestMgr:function(){this.requestMgr||(this.requestMgr=this.createRequestMgr());var t=this.requestMgr;t.on("success",this.hndRequestMgrSuccess,this),t.on("failure",this.hndRequestMgrFailure,this)},createRequestMgr:function(){return new this.requestMgrType({})},disable:function(){return this.disabled?this:(this.stopLast(),this.disabled=!0,this)},enable:function(){return this.disabled?(this.disabled=!1,this):this},startDetect:function(t){var e=rl.ew.init(t),i=e.getTarget();if(rl.isElement(i)&&!this.disabled&&(!rl.isElement(this._hoverTarget)||!rl.$(this._hoverTarget).within(i)&&!this.monitor.dw.within(i))&&(this.stopLast(),i=this._hoverTarget=this.getTipable(i))){if(rl.isNonNullStr(i.title)&&this.interceptTitles){{i.title}i.setAttribute(this.replacedTipAttrName,i.title),i.setAttribute(this.tippedAttrName,"local"),i.removeAttribute("title"),e.stopDefault()}this.beginShow()}},getTipable:function(t){return rl.$(t).upto(this.isTipable,this)},isTipable:function(t){var e=rl.$(t),i=[this.tippedAttrName,this.remoteTipAttrName,this.localTipAttrName,"title"];return Array.some(function(i){return e.hasAttribute(i)&&t.getAttribute(i)},i,e)},stopLast:function(){this.endShow()},beginShow:function(){if(this._showStarted||!this._hoverTarget)return this;var t=this._hoverTarget,e=(rl.$(t),this.tippedAttrName),i=this.localTipAttrName,r=t.getAttribute(e);return this._showStarted=!0,"local".equalsIgnoreCase(r)||rl.isNonNullStr(t.getAttribute(i))?this.startLocalMode():this.startRemoteMode(),this},endShow:function(){return this._showStarted=!1,delete this._hoverTarget,this._remoteModeStarted?this.endRemoteMode():this._localModeStarted&&this.endLocalMode(),this},startLocalMode:function(){if(!this._localModeStarted){var t=this._hoverTarget,e=this.tippedAttrName,i=this.localTipAttrName,r=this.replacedTipAttrName,s=t.getAttribute(e),o=s?r:i,n=t.getAttribute(o);rl.isNonNullStr(n)?(this._localModeStarted=!0,s||t.setAttribute(e,"local"),t.setAttribute(r,n),this.setMonitorContent(n),this.alignMonitor(t),this.showMonitor(t,n)):this._showStarted=!1}},endLocalMode:function(){this._localModeStarted=!1,this.hideMonitor()},startRemoteMode:function(t,e){if(this._remoteModeStarted)return this;var i,r,t=this._hoverTarget,s=this.tippedAttrName,o=this.remoteTipAttrName,n=t.getAttribute(o),e=t.getAttribute(s);if(rl.isNonNullStr(n))return this._remoteModeStarted=!0,e&&this.enableRemoteCache?r=i=this._remoteTipCache[n]:t.setAttribute(s,"remote"),rl.isNonNullStr(i)||(i=this.waitingContent||""),this.setMonitorContent(i),this.alignMonitor(t),r||(this.remoteUrl=n,window.clearTimeout(this._requestStartTimer),this._requestStartTimer=Function.delay(function(){this.startRequest(n)},this.requestDelay,this)),this.showMonitor(),this},endRemoteMode:function(){return this._remoteModeStarted=!1,window.clearTimeout(this._requestStartTimer),this.endRequest(),this.hideMonitor(),this},startRequest:function(t){return this._requestStarted?this:(this._requestStarted=!0,this.requestMgr.request({url:t}),this)},endRequest:function(){return this._requestStarted=!1,this.abortRequest(),this},abortRequest:function(){this.requestMgr.abort(),this.hideMonitor()},setMonitorContent:function(t){this.monitor.setContent(t,!0)},alignMonitor:function(t){this.monitor.alignTo(t,"be",!0)},showMonitor:function(){return this.monitor.beginAutoShow(),this},hideMonitor:function(){return this.monitor.beginAutoHide(),this},addArea:function(t){if(t=rl.getDom(t)){var e,i=this.areas;e=t.nodeType,1!=e&&9!=e||i.contains(t)||(i.push(t),this._observeArea(t))}return i.length},removeArea:function(t){t=rl.getDom(t);var e=this.areas,i=e.indexOf(t);return i>-1&&(e.removeAt(i),this._stopObservingArea(t)),t},_observeArea:function(t){rl.dom.addEventListener(t,"mouseover",this.hndAreaMouseover,this)},_stopObservingArea:function(t){rl.dom.removeEventListener(t,"mouseover",this.hndAreaMouseover,this)},hndAreaMouseover:function(t){this.startDetect(t)},hndMonitorHide:function(){this.endShow()},hndRequestMgrSuccess:function(t,e){if(t==this.requestOkStatus){var i=e[this.requestOkContentAttrName];this.enableRemoteCache&&(this._remoteTipCache[this.remoteUrl]=i),this.setMonitorContent(i,!0)}},hndRequestMgrFailure:function(){this.setMonitorContent(this.failureContent,!0),this.endRequest()},toString:function(){return"[object rl.gui.indicator.TipMgr]"}}})});